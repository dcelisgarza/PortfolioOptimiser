using CSV, Clarabel, HiGHS, LinearAlgebra, OrderedCollections, PortfolioOptimiser,
      Statistics, Test, TimeSeries, SCS

prices = TimeArray(CSV.File("./assets/stock_prices.csv"); timestamp = :date)

rf = 1.0329^(1 / 252) - 1
l = 2.0

@testset "$(:Classic), $(:WC), $(:Min_Risk)" begin
    portfolio = Portfolio(; prices = prices,
                          solvers = OrderedDict(:Clarabel => Dict(:solver => Clarabel.Optimizer,
                                                                  :params => Dict("verbose" => false,
                                                                                  "max_step_fraction" => 0.75))))
    asset_statistics!(portfolio; calc_kurt = false)

    opt = OptimiseOpt(; rf = rf, l = l, class = :Classic, type = :Trad, rm = :SD,
                      obj = :Min_Risk, kelly = :None)

    w0 = optimise!(portfolio, opt)

    wc_statistics!(portfolio, WCOpt(; box = :Normal, ellipse = :Normal, seed = 123456789))
    opt.type = :WC

    opt.u_cov = :None
    opt.u_mu = :None
    w1 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w2 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w3 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w4 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w5 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w6 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w7 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w8 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w9 = optimise!(portfolio, opt)
    wc_statistics!(portfolio, WCOpt(; box = :Delta, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w10 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w11 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w12 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w13 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w14 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w15 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w16 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w17 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w18 = optimise!(portfolio, opt)

    w1t = [0.007911813464310113, 0.03068510213747275, 0.010505366137939913,
           0.02748375285330511, 0.012276170276067139, 0.03340727036207522,
           3.968191684113028e-7, 0.1398469015680947, 6.62690268489184e-7,
           1.412505225860106e-5, 0.2878192785440307, 4.2200065419448415e-7,
           3.296864762413375e-7, 0.12527560333674628, 1.836077875288932e-6,
           0.015083599354027831, 2.2788913817547395e-5, 0.19311714086150886,
           8.333796539106878e-7, 0.11654660648424862]

    w2t = [0.010505262318488156, 0.02765001122547157, 0.005155696156015236,
           0.014740124727805618, 0.0010683067258207021, 0.025331092034838153,
           3.754513875090486e-7, 0.13424546801820192, 1.4866284657155555e-6,
           1.889293371471046e-5, 0.30785174082434547, 5.633771366027783e-7,
           3.110414526626435e-7, 0.12812721007458353, 1.2279377392624743e-6,
           8.308260894832433e-5, 0.00858474329309686, 0.20758996436563512,
           2.6296897472802944e-6, 0.12904181056710567]

    w3t = [0.00791133435075039, 0.03068870287979824, 0.010506523511630488,
           0.02748524016355353, 0.012276717412329111, 0.03341064876846345,
           1.6938875552451472e-8, 0.13984934627551662, 2.8727710165211805e-8,
           6.497794593560788e-7, 0.28782449943771365, 1.7895488098981285e-8,
           1.4092889813815445e-8, 0.12528285088799815, 8.15385421053231e-8,
           0.015084440027327891, 1.0645874759288279e-6, 0.19312474197164498,
           3.677285304090593e-8, 0.11655304397997937]

    w4t = [0.007920657427616102, 0.030668637277263787, 0.010500432216142167,
           0.02747291052000619, 0.012271335324959031, 0.03339309453273026,
           1.7288807624662253e-6, 0.1398419645980313, 2.9026467834348955e-6,
           6.137370886041355e-5, 0.2878082866151442, 1.846323615352377e-6,
           1.4383344416742414e-6, 0.12524860212395514, 7.99751837573715e-6,
           0.015077475176263464, 9.879305762316453e-5, 0.19309419174111606,
           3.645964678029406e-6, 0.11652268601163202]

    w5t = [0.01048532394724752, 0.027634726879025334, 0.0051582579275829595,
           0.014730229952227733, 0.001103482244495768, 0.025325763023433052,
           4.384456477310142e-7, 0.13424317043557146, 1.7339563286340342e-6,
           2.1982506028319674e-5, 0.3078546839507732, 6.580793426712629e-7,
           3.640388687087486e-7, 0.12812714403277226, 1.4335156330316576e-6,
           9.634755076943161e-5, 0.008584326247391505, 0.20759531561666966,
           3.0643263595912866e-6, 0.12903155332383157]

    w6t = [0.00791033446730111, 0.030689474113160854, 0.010506763539190158,
           0.027486156689267703, 0.012277218530783302, 0.03341126824804728,
           4.480086893229809e-9, 0.13984888451027336, 7.553679865236141e-9,
           1.7015621662334255e-7, 0.28782338885290293, 4.725994052338497e-9,
           3.730870553261804e-9, 0.12528332591780142, 2.144153388887167e-8,
           0.015085014172329046, 2.788404244002033e-7, 0.19312430067038175,
           9.636234517840858e-9, 0.11655336972352041]

    w7t = [0.007909537753027565, 0.030689718350577398, 0.010506789965477385,
           0.027486764390401854, 0.012277520175790528, 0.03341133546948309,
           2.617329232431501e-8, 0.13984829600559406, 4.4230459246590174e-8,
           9.424763040433055e-7, 0.2878221557185522, 2.820077591940548e-8,
           2.1716548346074978e-8, 0.12528313527445484, 1.2191180284853197e-7,
           0.015085349377190905, 1.522123259037069e-6, 0.1931234266475917,
           5.56819599654295e-8, 0.1165532083574569]

    w8t = [0.0106793203131909, 0.027726987791365898, 0.005180570065945575,
           0.014799058588638557, 0.000784649034333424, 0.025359575887394795,
           3.220313139471539e-9, 0.1342540228303488, 1.280500100419102e-8,
           1.638717125456159e-7, 0.30782743677839197, 4.839549370542625e-9,
           2.6628669999359355e-9, 0.12811924110343037, 1.0537604757478401e-8,
           7.606041702616209e-7, 0.008636130250626367, 0.2075345596852565,
           2.2623233918688416e-8, 0.12909746650662487]

    w9t = [0.007910141791300328, 0.030689574297892156, 0.010506778308193588,
           0.027486305017095942, 0.012277283952372072, 0.03341131992271594,
           3.6914210854036706e-9, 0.13984879210973375, 6.207172898657854e-9,
           1.3941933098886154e-7, 0.28782316304454536, 3.883438975194415e-9,
           3.066835521103725e-9, 0.12528342373215637, 1.7631125262979978e-8,
           0.01508508720567825, 2.2830431444321846e-7, 0.19312424768159978,
           7.924152492287261e-9, 0.11655347280892495]

    w10t = [0.007911813464310113, 0.03068510213747275, 0.010505366137939913,
            0.02748375285330511, 0.012276170276067139, 0.03340727036207522,
            3.968191684113028e-7, 0.1398469015680947, 6.62690268489184e-7,
            1.412505225860106e-5, 0.2878192785440307, 4.2200065419448415e-7,
            3.296864762413375e-7, 0.12527560333674628, 1.836077875288932e-6,
            0.015083599354027831, 2.2788913817547395e-5, 0.19311714086150886,
            8.333796539106878e-7, 0.11654660648424862]

    w11t = [0.007940343440459626, 0.030634853888863542, 0.010480246994367077,
            0.02746506524587317, 0.012245127022203104, 0.03334485036997602,
            3.500385774543004e-7, 0.13984265831460876, 9.094404090733543e-7,
            5.8228866272140154e-5, 0.2878742372792924, 4.0791092099686144e-7,
            2.783630539619788e-7, 0.1252635607495454, 4.520237197347675e-6,
            0.01506391038570315, 9.576531689175073e-5, 0.19312917261528162,
            1.5073402391213533e-6, 0.11655400618026439]

    w12t = [0.007910235920505236, 0.030689491576510505, 0.010506745696405162,
            0.027486224490728663, 0.012277228444984363, 0.03341123267141148,
            4.224194537952013e-9, 0.13984883319681163, 7.1639453852835615e-9,
            1.6196735963402543e-7, 0.28782333327395826, 4.462541563304768e-9,
            3.514415439274675e-9, 0.12528338512754866, 2.0335989318778127e-8,
            0.015085026610419014, 2.6532867237871574e-7, 0.19312432322718104,
            9.170266393137353e-9, 0.11655346359615128]

    w13t = [0.007920657427616102, 0.030668637277263787, 0.010500432216142167,
            0.02747291052000619, 0.012271335324959031, 0.03339309453273026,
            1.7288807624662253e-6, 0.1398419645980313, 2.9026467834348955e-6,
            6.137370886041355e-5, 0.2878082866151442, 1.846323615352377e-6,
            1.4383344416742414e-6, 0.12524860212395514, 7.99751837573715e-6,
            0.015077475176263464, 9.879305762316453e-5, 0.19309419174111606,
            3.645964678029406e-6, 0.11652268601163202]

    w14t = [0.007949498491646728, 0.03062225130426573, 0.010477563259287564,
            0.027458768148515687, 0.012239556732576276, 0.03333323672372583,
            4.381747243159045e-7, 0.13984112023857193, 1.132820086288224e-6,
            7.292905485153967e-5, 0.2878806653049824, 5.108095238294895e-7,
            3.497155080628157e-7, 0.1252575543601538, 5.661520843896587e-6,
            0.015060394731894257, 0.00011999425671139572, 0.19312762886413323,
            1.873887110975119e-6, 0.1165488716008864]

    w15t = [0.007910332996836534, 0.03068947453229854, 0.010506763574418158,
            0.027486157531765427, 0.01227721886674763, 0.03341126833003533,
            4.464353649826544e-9, 0.13984888382678443, 7.527094545435819e-9,
            1.695844452084546e-7, 0.28782338867508556, 4.709156546964233e-9,
            3.7176675703667853e-9, 0.12528332680637916, 2.1368651743276132e-8,
            0.01508501454610547, 2.7790326312769736e-7, 0.19312430090823415,
            9.602352815429842e-9, 0.11655337052832443]

    w16t = [0.007909537753027565, 0.030689718350577398, 0.010506789965477385,
            0.027486764390401854, 0.012277520175790528, 0.03341133546948309,
            2.617329232431501e-8, 0.13984829600559406, 4.4230459246590174e-8,
            9.424763040433055e-7, 0.2878221557185522, 2.820077591940548e-8,
            2.1716548346074978e-8, 0.12528313527445484, 1.2191180284853197e-7,
            0.015085349377190905, 1.522123259037069e-6, 0.1931234266475917,
            5.56819599654295e-8, 0.1165532083574569]

    w17t = [0.007912768239362008, 0.03068589410175436, 0.010503632047378112,
            0.02748597666548568, 0.01227380948028238, 0.03340490875896304,
            6.785740692047584e-9, 0.13984812074421996, 1.763443974091764e-8,
            1.1156911107698182e-6, 0.28782868561902863, 7.927804585452018e-9,
            5.395444887943042e-9, 0.12528456186279038, 8.755077943434774e-8,
            0.015083462593990876, 1.8179023224333371e-6, 0.19312706301782853,
            2.91361544588981e-8, 0.11655802884511897]

    w18t = [0.007910141064462665, 0.030689574388542123, 0.010506778291929903,
            0.027486305344401694, 0.012277284051283668, 0.03341131983771115,
            3.680149795164209e-9, 0.13984879167731482, 6.188092475140883e-9,
            1.3901275559716216e-7, 0.28782316330403235, 3.871351732916355e-9,
            3.0573922236089877e-9, 0.12528342435268414, 1.7579137212644867e-8,
            0.015085087321957734, 2.276403061877114e-7, 0.1931242480502282,
            7.899887922149698e-9, 0.11655347338637845]

    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t)
    @test isapprox(w3.weights, w3t, rtol = 1.0e-5)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t)
    @test isapprox(w6.weights, w6t, rtol = 1.0e-7)
    @test isapprox(w7.weights, w7t)
    @test isapprox(w8.weights, w8t)
    @test isapprox(w9.weights, w9t, rtol = 1.0e-5)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t)
    @test isapprox(w12.weights, w12t)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t)
    @test isapprox(w15.weights, w15t)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t)
    @test isapprox(w18.weights, w18t)
    @test isapprox(w0.weights, w1.weights)
    @test isapprox(w0.weights, w10.weights)
    @test isapprox(w1.weights, w10.weights)
    @test isapprox(w3.weights, w12.weights, rtol = 1.0e-8)
    @test isapprox(w7.weights, w16.weights, rtol = 1.0e-5)
    @test isapprox(w9.weights, w18.weights, rtol = 5.0e-5)
end

@testset "$(:Classic), $(:WC), $(:Utility)" begin
    portfolio = Portfolio(; prices = prices,
                          solvers = OrderedDict(:Clarabel => Dict(:solver => Clarabel.Optimizer,
                                                                  :params => Dict("verbose" => false,
                                                                                  "max_step_fraction" => 0.75))))
    asset_statistics!(portfolio)

    opt = OptimiseOpt(; rf = rf, l = l, class = :Classic, type = :Trad, rm = :SD,
                      obj = :Utility, kelly = :None)

    w0 = optimise!(portfolio, opt)

    wc_statistics!(portfolio, WCOpt(; box = :Normal, ellipse = :Normal, seed = 123456789))
    opt.type = :WC

    opt.u_cov = :None
    opt.u_mu = :None
    w1 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w2 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w3 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w4 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w5 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w6 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w7 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w8 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w9 = optimise!(portfolio, opt)
    wc_statistics!(portfolio, WCOpt(; box = :Delta, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w10 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w11 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w12 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w13 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w14 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w15 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w16 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w17 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w18 = optimise!(portfolio, opt)

    w1t = [1.8806825315287365e-9, 3.862038288374664e-9, 5.3002004387495145e-9,
           4.036002575991236e-9, 0.7741908142503021, 3.8445966380599916e-10,
           0.10998661007165159, 1.852701338887806e-9, 5.530542601292167e-9,
           1.7145172711134676e-9, 1.5657439073700846e-9, 4.404614975595981e-10,
           8.278998697027929e-10, 3.393489762947003e-10, 7.56536345977105e-10,
           0.11582251334241239, 1.8378733654274228e-8, 2.095243020357391e-9,
           1.0434852414339229e-8, 2.9356695212202287e-9]

    w2t = [2.805716182855447e-8, 6.08836560674535e-8, 1.0568078121539315e-7,
           6.412319419224896e-8, 0.7874637096101028, 8.774228637136583e-9,
           0.09194225139663352, 2.6192987734625515e-8, 9.665810121922179e-8,
           2.502489043857906e-8, 2.3372371214078192e-8, 8.255036261045137e-9,
           6.2570401010769666e-9, 1.3190093762174292e-8, 6.19853436271278e-9,
           0.12059116015354673, 1.957546955347339e-6, 2.9194381642424098e-8,
           3.771014356961893e-7, 4.232886722575466e-8]

    w3t = [1.534864248460469e-9, 4.157312229008504e-9, 5.872074246645295e-9,
           3.525043017535999e-9, 0.5625927443406936, 4.3331763745447816e-10,
           0.07157075882074597, 2.7336822239362514e-9, 4.267423927894166e-9,
           1.6275739735789695e-9, 2.272608622417698e-9, 3.597019776612817e-10,
           2.6608433609834453e-10, 7.845436932787495e-10, 2.563687522450837e-10,
           0.1478724512241401, 0.17030778337982083, 2.7977923339016173e-9,
           0.047656228113113354, 3.233094934495004e-9]

    w4t = [5.252194395056978e-9, 1.0315354940168556e-8, 9.455445139288418e-9,
           4.013209229711783e-9, 0.5819241901849773, 6.270890448664268e-10,
           2.0561433724117197e-9, 6.707564335612324e-9, 7.865563734245912e-9,
           4.17450063970948e-9, 1.0991695351988044e-8, 2.190782811533936e-10,
           1.1231785837732019e-10, 2.540524563038986e-9, 1.8113974061846706e-10,
           1.0750087695591245e-8, 0.4180755819596067, 1.2097725746430656e-8,
           1.273857143447765e-7, 1.3110067658773902e-8]

    w5t = [7.450617569435218e-8, 1.691770721106442e-7, 1.5674713909543173e-7,
           5.366042775942177e-8, 0.5520776394586348, 1.841614638968509e-8,
           2.9069631672507916e-8, 9.268404826263314e-8, 1.0485330110287837e-7,
           5.446057054512299e-8, 1.895901900882436e-7, 1.1836606212753126e-8,
           6.95050328547548e-9, 3.6737651102745956e-8, 8.326868461141755e-9,
           1.4663521610097443e-7, 0.4479156448057725, 2.156962163971092e-7,
           5.09262226349376e-6, 2.5376556505840216e-7]

    w6t = [1.4359419266226849e-9, 3.958537256499743e-9, 2.875796074067922e-9,
           1.08084259415127e-9, 0.399750018957966, 3.6738324940551096e-10,
           5.213193956534155e-10, 4.728337071388599e-9, 1.5810062504266924e-9,
           1.2336050669381269e-9, 0.032982827875995976, 2.0352257205975656e-10,
           1.1531933156626026e-10, 8.546392990565349e-10, 1.392254191169641e-10,
           6.206899064553828e-9, 0.4425932916766414, 4.1524798028839716e-8,
           0.12467378247584977, 1.2186374270681762e-8]

    w7t = [0.00469218488919128, 0.031698559601714145, 0.012130457668736732,
           0.02810785461963848, 0.018931761478043697, 0.02365175458519924,
           1.4164111569690342e-8, 0.13876952218816935, 2.3235136044934667e-8,
           9.071504290052429e-7, 0.2889434364533288, 1.2659467826722461e-8,
           9.679441523338648e-9, 0.12087817866982871, 3.85666515273017e-8,
           0.017060525794678205, 0.003168088039807349, 0.19500339385971244,
           3.052005333943924e-8, 0.11696324617666075]

    w8t = [0.004706423102241968, 0.03168030838547994, 0.012096425593067837,
           0.028033743453249757, 0.01886082143842364, 0.023605772923083305,
           4.063118956969112e-10, 0.13873686378378447, 7.218201544092801e-10,
           4.020992071533049e-8, 0.2890607526483452, 4.1735680601645823e-10,
           2.9350301820621834e-10, 0.12089215224605229, 1.108640530807238e-9,
           0.01696578112352994, 0.0032396591059640273, 0.1950843432273647,
           9.296062232032858e-10, 0.11703690888225374]

    w9t = [0.0047065597146616935, 0.03169668691848593, 0.012125303961267856,
           0.02810648261524976, 0.01890586063784152, 0.023691817665372695,
           1.1940811882621197e-10, 0.13877440357002704, 1.9577193053668657e-10,
           8.386219192835316e-9, 0.28893958924002866, 1.0450917623426724e-10,
           7.980013414424715e-11, 0.12089832748727787, 3.3488027522681367e-10,
           0.01705318568949431, 0.0031394172851326517, 0.1949983598353977,
           2.557805814967098e-10, 0.11696399590339293]

    w10t = [1.8806825315287365e-9, 3.862038288374664e-9, 5.3002004387495145e-9,
            4.036002575991236e-9, 0.7741908142503021, 3.8445966380599916e-10,
            0.10998661007165159, 1.852701338887806e-9, 5.530542601292167e-9,
            1.7145172711134676e-9, 1.5657439073700846e-9, 4.404614975595981e-10,
            8.278998697027929e-10, 3.393489762947003e-10, 7.56536345977105e-10,
            0.11582251334241239, 1.8378733654274228e-8, 2.095243020357391e-9,
            1.0434852414339229e-8, 2.9356695212202287e-9]

    w11t = [9.404652325727814e-9, 1.719868515706557e-8, 2.8483182803795e-8,
            1.853177179679032e-8, 0.7565390342554569, 3.9972899878833765e-9,
            0.1059280993027199, 8.974718284349187e-9, 2.6157918994097238e-8,
            8.638697017100152e-9, 8.226099866073654e-9, 3.841004767255786e-9,
            3.0219011228410342e-9, 5.4547626890407746e-9, 3.0225617033537158e-9,
            0.13753218743600373, 4.178744252926253e-7, 9.656312612804123e-9,
            9.37669381383348e-8, 1.2754897051566412e-8]

    w12t = [1.5351442936283775e-9, 4.163764993892425e-9, 5.881638010458597e-9,
            3.5282312836947187e-9, 0.5621106897704137, 4.332058513218893e-10,
            0.07148502996216848, 2.7413583603782042e-9, 4.261306465800872e-9,
            1.6282592154714858e-9, 2.2779161891166494e-9, 3.5950207880949743e-10,
            2.6596174763979224e-10, 7.846479236802063e-10, 2.5623215068204605e-10,
            0.1478226128009851, 0.17059127068557703, 2.8039624575248114e-9,
            0.04799036262107277, 3.2386521233437826e-9]

    w13t = [3.647902119428961e-10, 2.1977715335790454e-9, 4.064170032796999e-9,
            2.3972232748394194e-9, 0.75478163814755, 1.0679235246725186e-9,
            0.10551594374842024, 3.776810262001307e-10, 4.357820292261647e-9,
            2.573044832077191e-10, 2.0018803785122081e-10, 1.0995315175089325e-9,
            1.220582723514187e-9, 6.127953723783301e-10, 1.2973729020478185e-9,
            0.13970233618556752, 4.547259952804259e-8, 5.552311979866896e-10,
            1.5145933671581878e-8, 1.229542917036613e-9]

    w14t = [2.5072209766309822e-8, 6.524666595724082e-8, 1.1896052969985183e-7,
            6.909663326699326e-8, 0.7308742850376809, 7.212472757491972e-9,
            0.10068813093051053, 2.254831575050526e-8, 1.132357089583602e-7,
            2.1019738015053924e-8, 1.9730851398734935e-8, 6.8360481915692516e-9,
            5.105795130626096e-9, 1.0818491016554973e-8, 5.1298284977106645e-9,
            0.15517673273094307, 0.013259494231541139, 2.554183563971588e-8,
            8.004181652842922e-7, 4.109603501203217e-8]

    w15t = [6.700644303867419e-9, 2.7346772645231732e-8, 4.143843190846203e-8,
            2.115284557670638e-8, 0.520718902229397, 1.4716104342716822e-9,
            0.06412356631228829, 1.601759614344125e-8, 2.0247700727524616e-8,
            6.735138361489334e-9, 1.1680731895971069e-8, 1.2291792468768682e-9,
            8.913962803082978e-10, 2.7632296701678037e-9, 8.745330126253779e-10,
            0.1435429871909071, 0.19493001245938302, 1.5819211071824472e-8,
            0.07668433735485847, 2.0084144837015935e-8]

    w16t = [0.004697996582645784, 0.03169773317368855, 0.01212836924527206,
            0.028107258379806065, 0.018921469152662115, 0.02366751878751497,
            1.416593352994574e-8, 0.13877142003212317, 2.323932050880105e-8,
            9.060928886353006e-7, 0.2889418574884957, 1.266469741005018e-8,
            9.683523903440353e-9, 0.12088603063358541, 3.859915732755972e-8,
            0.01705758549257774, 0.003157030166023766, 0.19500127453828386,
            3.0523317926338015e-8, 0.11696342135848171]

    w17t = [0.0046999926158568725, 0.03169753080394291, 0.012127708024154566,
            0.028107105688067204, 0.018917943968505015, 0.023673152619548134,
            7.103945044565475e-10, 0.13877211816636065, 1.274115641722327e-9,
            4.005715463914471e-8, 0.2889413674978244, 7.56620992366105e-10,
            5.399950235077461e-10, 0.12088887213180054, 1.6031862559234761e-9,
            0.01705668322015882, 0.003153247207059865, 0.19500065712470188,
            1.6797383183693063e-9, 0.11696357431081376]

    w18t = [0.004712365690941998, 0.03169586181384043, 0.012123218062799259,
            0.028105887222626906, 0.018895580323139, 0.02370756351234234,
            1.1938769236687233e-10, 0.13877629926058524, 1.9576195035921823e-10,
            8.373597985463366e-9, 0.2889380120881857, 1.045339929956052e-10,
            7.981649809285592e-11, 0.12090617072413258, 3.350379868483922e-10,
            0.017050248850665386, 0.0031283685277785018, 0.19499624325623516,
            2.557498478481148e-10, 0.11696417120284147]

    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t)
    @test isapprox(w3.weights, w3t)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t)
    @test isapprox(w6.weights, w6t)
    @test isapprox(w7.weights, w7t)
    @test isapprox(w8.weights, w8t)
    @test isapprox(w9.weights, w9t, rtol = 1.0e-5)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t)
    @test isapprox(w12.weights, w12t, rtol = 1.0e-5)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t)
    @test isapprox(w15.weights, w15t)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t)
    @test isapprox(w18.weights, w18t, rtol = 1.0e-5)
    @test isapprox(w0.weights, w1.weights)
    @test isapprox(w0.weights, w10.weights)
    @test isapprox(w1.weights, w10.weights)
    @test !isapprox(w3.weights, w12.weights)
    @test !isapprox(w7.weights, w16.weights)
    @test !isapprox(w9.weights, w18.weights)
end

@testset "$(:Classic), $(:WC), $(:Sharpe)" begin
    portfolio = Portfolio(; prices = prices,
                          solvers = OrderedDict(:Clarabel => Dict(:solver => Clarabel.Optimizer,
                                                                  :params => Dict("verbose" => false,
                                                                                  "max_step_fraction" => 0.75))))
    asset_statistics!(portfolio)

    opt = OptimiseOpt(; rf = rf, l = l, class = :Classic, type = :Trad, rm = :SD,
                      obj = :Sharpe, kelly = :None)

    w0 = optimise!(portfolio, opt)

    opt.type = :WC
    wc_statistics!(portfolio, WCOpt(; box = :Normal, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w1 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w2 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w3 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w4 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w5 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w6 = optimise!(portfolio, opt)
    wc_statistics!(portfolio, WCOpt(; box = :Delta, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w10 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w11 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w12 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w13 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w14 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w15 = optimise!(portfolio, opt)
    opt.kelly = :Approx
    opt.u_cov = :None
    opt.u_mu = :None
    w16 = optimise!(portfolio, opt)
    opt.kelly = :Exact
    w17 = optimise!(portfolio, opt)

    w1t = [1.0582219191763675e-9, 3.033341281368263e-9, 4.093973467616387e-9,
           2.4302432491378547e-9, 0.518058049464457, 3.284428917099043e-10,
           0.06365095369119145, 2.483269319093602e-9, 2.345993206888518e-9,
           1.1710759933582023e-9, 1.9667796025518083e-9, 2.6638354190663204e-10,
           1.933888387868567e-10, 5.926494610003628e-10, 1.8755971351419546e-10,
           0.143267787756283, 0.19649630246514146, 2.335142195851285e-9,
           0.07852688169059606, 2.4458664972621787e-9]

    w2t = [2.8412816525478146e-8, 0.00035196294061108315, 1.3052329509733161e-6,
           2.87254720878552e-7, 0.2666085608412865, 3.066695991497784e-9,
           0.011445317506056641, 0.06657588647768221, 4.956539340550331e-8,
           4.942883684369277e-8, 0.1613717386465365, 1.9418616900887073e-9,
           1.3645330112497187e-9, 1.1146847727603151e-8, 1.4308219462717556e-9,
           0.07263796658744098, 0.2016984496157288, 0.10136663350490349,
           0.08771684891228358, 0.030224896121991304]

    w3t = [1.5321915912768136e-8, 0.007778594364678727, 0.0038647090167795665,
           0.0027541959806213594, 0.25098953235250115, 3.6350497186889743e-9,
           0.02316000903295803, 0.08562662946930592, 1.945923822570519e-8,
           2.1107941032070276e-8, 0.1623543613737965, 2.3582217317784873e-9,
           1.6723586143852862e-9, 9.814075202497617e-9, 1.7931536536068601e-9,
           0.0833419033229228, 0.16534873407147727, 0.10482691810739306,
           0.07552962347257514, 0.03442471427303637]

    w4t = [6.466684324776656e-11, 8.516807283687845e-11, 9.472315022300327e-11,
           5.1957167657756756e-11, 0.9999999985074259, 2.0192854664051626e-11,
           3.436252425053897e-11, 5.149260592067322e-11, 7.462642590762538e-11,
           4.561655322527492e-11, 6.186767722266438e-11, 1.3899284282467578e-11,
           7.750637790067232e-12, 3.337064177968372e-11, 9.659444439315246e-12,
           7.302466718285475e-11, 4.5866872942896926e-10, 7.012474376020365e-11,
           1.5414496160965011e-10, 8.72570588192862e-11]

    w5t = [1.9409089548743477e-10, 3.1564619696752674e-10, 3.25738141555929e-10,
           1.5005563626271312e-10, 0.7008304542355122, 5.069791714974362e-11,
           8.841751111869289e-11, 1.8416820618235487e-10, 2.578481887264228e-10,
           1.4192124066866055e-10, 2.5722874917391247e-10, 3.295120542776688e-11,
           1.8052557212010085e-11, 9.760762013674915e-11, 2.1941995624520676e-11,
           2.8101096518769044e-10, 0.29916954115599875, 2.9589738294333433e-10,
           1.536051217227758e-9, 3.591635066988638e-10]

    w6t = [8.510713846948011e-10, 1.368572518070052e-9, 1.3689181260651854e-9,
           6.742689269063031e-10, 0.6864094871923422, 2.4840237233488856e-10,
           4.0753201323440513e-10, 8.654433854616809e-10, 1.1359840534073957e-9,
           6.560742774525492e-10, 1.1960355956232209e-9, 1.5955467508887177e-10,
           9.026932481707672e-11, 4.634725902256178e-10, 1.0920613051971341e-10,
           1.2900040474594334e-9, 0.31359049323435206, 1.3430106933086768e-9,
           5.795333258966763e-9, 1.5501524052292743e-9]

    w10t = [1.0582219191763675e-9, 3.033341281368263e-9, 4.093973467616387e-9,
            2.4302432491378547e-9, 0.518058049464457, 3.284428917099043e-10,
            0.06365095369119145, 2.483269319093602e-9, 2.345993206888518e-9,
            1.1710759933582023e-9, 1.9667796025518083e-9, 2.6638354190663204e-10,
            1.933888387868567e-10, 5.926494610003628e-10, 1.8755971351419546e-10,
            0.143267787756283, 0.19649630246514146, 2.335142195851285e-9,
            0.07852688169059606, 2.4458664972621787e-9]

    w11t = [1.2956131060418805e-8, 0.007766319902530555, 0.0038698884729426297,
            0.0027575452131157895, 0.25099632102291025, 1.858344145755973e-9,
            0.02315866528942557, 0.08562254546821742, 2.5174951275929287e-8,
            2.232352055014575e-8, 0.16236982155031543, 1.202395823623793e-9,
            8.423879654324937e-10, 5.821294294758675e-9, 9.014353926181081e-10,
            0.08334324969810843, 0.1653508499370702, 0.10483367172634506,
            0.07552186008510518, 0.03440919055345298]

    w12t = [1.5291187482938645e-8, 0.007778595200784307, 0.0038647080835561482,
            0.002754194910842754, 0.2509895342250983, 3.627336459836987e-9,
            0.02316000973479629, 0.08562662809949309, 1.9420189145105742e-8,
            2.10662644136409e-8, 0.1623543583531578, 2.3531955885506705e-9,
            1.6687698758089001e-9, 9.793906871753034e-9, 1.7893109045429747e-9,
            0.08334190435552301, 0.16534873523604937, 0.1048269164308098,
            0.07552962547587076, 0.03442471488385758]

    w13t = [7.86104680168596e-11, 2.581689370363608e-10, 3.751927152447362e-10,
            2.1247028587508447e-10, 0.523634883488626, 1.9486433116903062e-11,
            0.06464274713780861, 1.549689208956321e-10, 2.0554803821712053e-10,
            7.975947674723269e-11, 1.2077742964126379e-10, 1.6434493809377638e-11,
            1.1964486515368817e-11, 3.6573008241479916e-11, 1.0468424536562565e-11,
            0.14384439793458836, 0.19321690478313466, 1.5557988191105592e-10,
            0.07466106472997303, 1.898664279910272e-10]

    w14t = [1.2263904439118016e-8, 0.007060252113352363, 0.0036540730976423025,
            0.0021522184115763767, 0.2551009198991718, 1.1756276183234802e-9,
            0.023705335955290292, 0.08460251834282648, 2.3885920274456877e-8,
            2.0788888043866e-8, 0.15915641603733602, 7.943942762030404e-10,
            5.310613607982868e-10, 3.797525765151979e-9, 5.674070944570201e-10,
            0.08446004253353889, 0.16761618932791755, 0.10250681464525724,
            0.07714491088562073, 0.03284024494574102]

    w15t = [9.810815466152289e-9, 0.007071976009969929, 0.00365173823819271,
            0.0021478108762156057, 0.2550935967489524, 1.8640654683717285e-9,
            0.023706572439827375, 0.08460583256397154, 1.3674932676978091e-8,
            1.357064101943576e-8, 0.1591439736845676, 1.262940520015059e-9,
            8.878675200488327e-10, 5.039094129557091e-9, 9.412599414346414e-10,
            0.08445861354297991, 0.16761336235774132, 0.10250140721054403,
            0.07715035042874414, 0.03285471884667695]

    w16t = [1.8936023733971716e-7, 7.759755252629935e-7, 1.030806203991613e-6,
            4.859440578422584e-7, 0.45249930505411073, 5.660324801246874e-8,
            0.05199219525670206, 2.6247324027201767e-6, 3.080955476028156e-7,
            2.2165249031163672e-7, 9.981959921562277e-7, 4.3163677394287155e-8,
            3.194465829791772e-8, 1.0930201332601899e-7, 3.1218211513058067e-8,
            0.13648884753629192, 0.2350440113219722, 9.922895023025335e-7,
            0.1239670381377456, 7.034094093603752e-7]

    w17t = [2.0184456345048768e-8, 6.618692139937966e-8, 8.648692815426136e-8,
            4.760981393989345e-8, 0.48941508879975115, 6.2929759532963e-9,
            0.05833663800209291, 6.853354731936131e-8, 4.458883181890003e-8,
            2.298252674522769e-8, 4.96139104169387e-8, 5.101272720052931e-9,
            3.722385516976071e-9, 1.1484275309689927e-8, 3.614760596055875e-9,
            0.140325949013441, 0.21337780603089268, 5.831498491601652e-8,
            0.09854396946956434, 5.3966666897345284e-8]
    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t, rtol = 1.0e-6)
    @test isapprox(w3.weights, w3t, rtol = 1e-7)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t, rtol = 1.0e-6)
    @test isapprox(w6.weights, w6t, rtol = 1.0e-6)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t, rtol = 1.0e-6)
    @test isapprox(w12.weights, w12t, rtol = 1e-7)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t, rtol = 1.0e-5)
    @test isapprox(w15.weights, w15t, rtol = 1.0e-5)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t, rtol = 1.0e-5)
    @test isapprox(w0.weights, w1.weights, rtol = 1.0e-7)
    @test isapprox(w0.weights, w10.weights, rtol = 1.0e-7)
    @test isapprox(w1.weights, w10.weights)
    @test isapprox(w3.weights, w12.weights, rtol = 1.0e-7)
end

@testset "$(:Classic), $(:WC), $(:Max_Ret)" begin
    portfolio = Portfolio(; prices = prices,
                          solvers = OrderedDict(:Clarabel => Dict(:solver => Clarabel.Optimizer,
                                                                  :params => Dict("verbose" => false,
                                                                                  "max_step_fraction" => 0.75))))
    asset_statistics!(portfolio)

    opt = OptimiseOpt(; rf = rf, l = l, class = :Classic, type = :Trad, rm = :SD,
                      obj = :Max_Ret, kelly = :None)

    w0 = optimise!(portfolio, opt)

    wc_statistics!(portfolio, WCOpt(; box = :Normal, ellipse = :Normal, seed = 123456789))
    opt.type = :WC

    opt.u_cov = :None
    opt.u_mu = :None
    w1 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w2 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w3 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w4 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w5 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w6 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w7 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w8 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w9 = optimise!(portfolio, opt)
    wc_statistics!(portfolio, WCOpt(; box = :Delta, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w10 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w11 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w12 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w13 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w14 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w15 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w16 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w17 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w18 = optimise!(portfolio, opt)

    w1t = [2.242587206880573e-8, 2.3869345719665024e-8, 3.0249972077364615e-8,
           2.7441036414624337e-8, 2.674016473443787e-6, 1.111794542964317e-8,
           0.999996954927899, 1.6603745204232977e-8, 2.5223224543701134e-8,
           1.8088400369515617e-8, 1.6172380723211374e-8, 1.16166386268502e-8,
           8.681387038232673e-9, 1.3771962838160079e-8, 8.992921449936008e-9,
           4.039243448317557e-8, 3.1600448893350835e-8, 1.7426103715815354e-8,
           2.6166436902355393e-8, 2.121537093958793e-8]

    w2t = [6.989037895383436e-8, 7.480538211882142e-8, 9.691293470711082e-8,
           8.678037210737846e-8, 8.837803088408388e-6, 3.40581564078145e-8,
           0.999989993339588, 5.0910247631747685e-8, 7.956894828568414e-8,
           5.5670422521762763e-8, 4.9439177610106315e-8, 3.572433741796514e-8,
           2.7230914956887026e-8, 4.200273372251963e-8, 2.7981881709706302e-8,
           1.336944045080762e-7, 1.019575350256201e-7, 5.343621688355654e-8,
           8.291247355406826e-8, 6.588080521189712e-8]

    w3t = [1.4060921805235678e-10, 1.4949077233619802e-10, 1.891469810220563e-10,
           1.7136936559291537e-10, 1.7263712877360994e-8, 7.150739340310614e-11,
           0.9999999803939431, 1.053761521517774e-10, 1.581562203951017e-10,
           1.1445175043694404e-10, 1.0252882112526467e-10, 7.50736768261991e-11,
           5.6767564333026305e-11, 8.789211612315543e-11, 5.849663309620243e-11,
           2.5610705259602627e-10, 1.97927331871931e-10, 1.1017186447340506e-10,
           1.6400086192517422e-10, 1.3326996747308843e-10]

    w4t = [4.2042049734727806e-8, 4.521518897189257e-8, 5.659006070667893e-8,
           3.514877814292186e-8, 0.9999993010578468, 1.5765085402586468e-8,
           2.7221728971256205e-8, 2.833331125793981e-8, 4.0442398566396016e-8,
           2.820564078004165e-8, 3.015401882144552e-8, 1.3622176589629896e-8,
           8.610124539098548e-9, 2.1881580106619616e-8, 1.0054344351204034e-8,
           3.857715060414015e-8, 1.2018663273637416e-7, 3.337382833665426e-8,
           5.928283670571385e-8, 4.42352177893344e-8]

    w5t = [9.377415466609279e-8, 1.0272420517112992e-7, 1.2379069963449228e-7,
           7.88908877064689e-8, 0.9999984542188851, 3.381052043433265e-8,
           6.063461327909876e-8, 6.528284321580322e-8, 9.272801754761999e-8,
           6.438645876637771e-8, 7.101071935434272e-8, 2.8462432632992756e-8,
           1.7554303492159786e-8, 4.916101198170805e-8, 2.050205062361616e-8,
           8.907634792253174e-8, 2.403215484938327e-7, 7.852171953659121e-8,
           1.338002068689107e-7, 1.0134837351440007e-7]

    w6t = [5.625466722347094e-11, 6.205759795810088e-11, 7.574727528721409e-11,
           4.673261003628035e-11, 0.9999999990746032, 1.9236659513414705e-11,
           3.540535381787307e-11, 3.8122510959053476e-11, 5.5572089269728423e-11,
           3.756758642544284e-11, 4.175945668369203e-11, 1.631064138152141e-11,
           9.991904223580483e-12, 2.8251914269238797e-11, 1.1690030274220593e-11,
           5.333084368188005e-11, 1.4743061474199397e-10, 4.651918866482874e-11,
           8.220798782881751e-11, 6.120777507566042e-11]

    w7t = [0.0046721172908753255, 0.03170141579463929, 0.01213766013782356,
           0.028109914581212234, 0.018967271313132097, 0.023597358371336166,
           1.3756888950294821e-8, 0.13876297990804762, 2.3011568711412734e-8,
           9.09936217813558e-7, 0.2889488980264342, 1.2280011132334528e-8,
           9.269054486643694e-9, 0.12085110209427886, 3.81947581679518e-8,
           0.017070663589890622, 0.0032061940140785733, 0.19501072450060497,
           3.0344217447937674e-8, 0.11696266358492978]

    w8t = [0.004672148259123759, 0.03170139300342473, 0.012137645477664645,
           0.02810989963816652, 0.018967260154546497, 0.023597332393779955,
           1.531701529104661e-8, 0.1387629714487798, 2.5465833007691113e-8,
           1.0152018500072269e-6, 0.28894888192952545, 1.3598053931972363e-8,
           1.0342478716606663e-8, 0.12085106949218538, 4.2352433668013854e-8,
           0.017070652026483463, 0.003206267348056645, 0.19501069102818477,
           3.35113015778433e-8, 0.11696263201111216]

    w9t = [0.004671815452093565, 0.03170161979880333, 0.012137786952203656,
           0.02811004545712534, 0.018967380636045826, 0.023597584501118526,
           3.7707818864011115e-10, 0.1387630554519415, 6.1290792274482e-10,
           2.417769172830246e-8, 0.28894903117319537, 3.3002228506142965e-10,
           2.539258303495999e-10, 0.12085138691422098, 1.0287300287779874e-9,
           0.017070760442991113, 0.0032055407076310677, 0.19501102308057078,
           7.975294321061371e-10, 0.1169629418541733]

    w10t = [2.242587206880573e-8, 2.3869345719665024e-8, 3.0249972077364615e-8,
            2.7441036414624337e-8, 2.674016473443787e-6, 1.111794542964317e-8,
            0.999996954927899, 1.6603745204232977e-8, 2.5223224543701134e-8,
            1.8088400369515617e-8, 1.6172380723211374e-8, 1.16166386268502e-8,
            8.681387038232673e-9, 1.3771962838160079e-8, 8.992921449936008e-9,
            4.039243448317557e-8, 3.1600448893350835e-8, 1.7426103715815354e-8,
            2.6166436902355393e-8, 2.121537093958793e-8]

    w11t = [6.989037895383436e-8, 7.480538211882142e-8, 9.691293470711082e-8,
            8.678037210737846e-8, 8.837803088408388e-6, 3.40581564078145e-8,
            0.999989993339588, 5.0910247631747685e-8, 7.956894828568414e-8,
            5.5670422521762763e-8, 4.9439177610106315e-8, 3.572433741796514e-8,
            2.7230914956887026e-8, 4.200273372251963e-8, 2.7981881709706302e-8,
            1.336944045080762e-7, 1.019575350256201e-7, 5.343621688355654e-8,
            8.291247355406826e-8, 6.588080521189712e-8]

    w12t = [1.4060921805235678e-10, 1.4949077233619802e-10, 1.891469810220563e-10,
            1.7136936559291537e-10, 1.7263712877360994e-8, 7.150739340310614e-11,
            0.9999999803939431, 1.053761521517774e-10, 1.581562203951017e-10,
            1.1445175043694404e-10, 1.0252882112526467e-10, 7.50736768261991e-11,
            5.6767564333026305e-11, 8.789211612315543e-11, 5.849663309620243e-11,
            2.5610705259602627e-10, 1.97927331871931e-10, 1.1017186447340506e-10,
            1.6400086192517422e-10, 1.3326996747308843e-10]

    w13t = [2.2157629001814043e-8, 2.3705206178889556e-8, 3.1337524512027466e-8,
            2.7822239462468775e-8, 3.817602380688397e-6, 1.0845455226582203e-8,
            0.9999958072350622, 1.6162961145208927e-8, 2.5262648251923497e-8,
            1.7620900422092873e-8, 1.572567737326121e-8, 1.129544407446688e-8,
            8.418152681037229e-9, 1.3392424290139792e-8, 8.742579157457356e-9,
            4.5537115159563596e-8, 3.30644482886816e-8, 1.6950167741040277e-8,
            2.6312815513451374e-8, 2.0809168671644914e-8]

    w14t = [6.18672522752248e-8, 6.660463315847458e-8, 9.006687455402096e-8,
            7.887070495555246e-8, 1.089918703360366e-5, 3.042154927163067e-8,
            0.999988034157972, 4.4828590574552585e-8, 7.135787933478868e-8,
            4.8960556991011206e-8, 4.3562684666504686e-8, 3.1867139337999185e-8,
            2.4373219474750287e-8, 3.7212092126252046e-8, 2.5047494973655907e-8,
            1.3578505229067643e-7, 9.590392555704405e-8, 4.701335158291311e-8,
            7.47932751792461e-8, 5.811871818279355e-8]

    w15t = [3.3281309601857706e-11, 3.577844852956738e-11, 4.772107184708236e-11,
            4.2187306000439357e-11, 5.180733138704124e-9, 1.6193242121087643e-11,
            0.9999999942520769, 2.420638218957642e-11, 3.827606425119956e-11,
            2.6418679537901197e-11, 2.3525637242210277e-11, 1.7025096922249347e-11,
            1.2637304827598294e-11, 2.0064157336385215e-11, 1.305101622447521e-11,
            6.960620014774633e-11, 5.053589271818753e-11, 2.5373021644713495e-11,
            4.002318033696007e-11, 3.1285959467081785e-11]

    w16t = [0.004677992641305413, 0.03170058061076934, 0.012135548911470388,
            0.028109311997326292, 0.018956865729027328, 0.023613296712695457,
            1.3734622593320603e-8, 0.13876489880003778, 2.29763754916088e-8,
            9.073169185152159e-7, 0.288947301873349, 1.226375773403534e-8,
            9.256663161011138e-9, 0.12085904107714182, 3.81622149524382e-8,
            0.017067691069460544, 0.0031950131110503616, 0.1950085823056898,
            3.029587611619325e-8, 0.11696284115424788]

    w17t = [0.004678023466507036, 0.03170055780032063, 0.012135534260684639,
            0.028109297049122454, 0.01895685457579417, 0.02361327077533017,
            1.529332076344184e-8, 0.13876489034443115, 2.5428745820216096e-8,
            1.0123548143835232e-6, 0.2889472857859125, 1.3581098281879493e-8,
            1.0329413253797027e-8, 0.12085900845986355, 4.231934145005255e-8,
            0.017067679514578615, 0.003195086802312902, 0.19500854882831983,
            3.3460421206773986e-8, 0.11696280956966712]

    w18t = [0.004677692224457835, 0.031700784618359824, 0.012135675614600933,
            0.028109442809195133, 0.018956974937097592, 0.023613522379113225,
            3.7643177664770155e-10, 0.13876497425659265, 6.119062717921685e-10,
            2.4105056922167898e-8, 0.2889474348348288, 3.2955530296435124e-10,
            2.535624468727092e-10, 0.12085932581116782, 1.0277430411425495e-9,
            0.017067787792352643, 0.003194357225595077, 0.19500888070324543,
            7.961660454939218e-10, 0.11696311929297115]

    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t)
    @test isapprox(w3.weights, w3t)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t)
    @test isapprox(w6.weights, w6t)
    @test isapprox(w7.weights, w7t)
    @test isapprox(w8.weights, w8t)
    @test isapprox(w9.weights, w9t)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t)
    @test isapprox(w12.weights, w12t)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t)
    @test isapprox(w15.weights, w15t)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t)
    @test isapprox(w18.weights, w18t)
    @test isapprox(w0.weights, w1.weights)
    @test isapprox(w0.weights, w10.weights)
    @test isapprox(w1.weights, w10.weights)
    @test isapprox(w3.weights, w12.weights)
    @test !isapprox(w7.weights, w16.weights)
    @test !isapprox(w9.weights, w18.weights)
end
