using CSV, Clarabel, HiGHS, LinearAlgebra, OrderedCollections, PortfolioOptimiser,
      Statistics, Test, TimeSeries

prices = TimeArray(CSV.File("./assets/stock_prices.csv"); timestamp = :date)

rf = 1.0329^(1 / 252) - 1
l = 2.0

@testset "$(:Classic), $(:WC), $(:Min_Risk)" begin
    portfolio = Portfolio(; prices = prices,
                          solvers = OrderedDict(:Clarabel => Dict(:solver => Clarabel.Optimizer,
                                                                  :params => Dict("verbose" => false,
                                                                                  "max_step_fraction" => 0.75))))
    asset_statistics!(portfolio; calc_kurt = false)

    opt = OptimiseOpt(; rf = rf, l = l, class = :Classic, type = :Trad, rm = :SD,
                      obj = :Min_Risk, kelly = :None)

    w0 = optimise!(portfolio, opt)

    wc_statistics!(portfolio, WCOpt(; box = :Normal, ellipse = :Normal, seed = 123456789))
    opt.type = :WC

    opt.u_cov = :None
    opt.u_mu = :None
    w1 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w2 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w3 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w4 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w5 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w6 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w7 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w8 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w9 = optimise!(portfolio, opt)
    wc_statistics!(portfolio, WCOpt(; box = :Delta, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w10 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w11 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w12 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w13 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w14 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w15 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w16 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w17 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w18 = optimise!(portfolio, opt)

    w1t = [0.007911813464310113, 0.03068510213747275, 0.010505366137939913,
           0.02748375285330511, 0.012276170276067139, 0.03340727036207522,
           3.968191684113028e-7, 0.1398469015680947, 6.62690268489184e-7,
           1.412505225860106e-5, 0.2878192785440307, 4.2200065419448415e-7,
           3.296864762413375e-7, 0.12527560333674628, 1.836077875288932e-6,
           0.015083599354027831, 2.2788913817547395e-5, 0.19311714086150886,
           8.333796539106878e-7, 0.11654660648424862]

    w2t = [0.010505262318488156, 0.02765001122547157, 0.005155696156015236,
           0.014740124727805618, 0.0010683067258207021, 0.025331092034838153,
           3.754513875090486e-7, 0.13424546801820192, 1.4866284657155555e-6,
           1.889293371471046e-5, 0.30785174082434547, 5.633771366027783e-7,
           3.110414526626435e-7, 0.12812721007458353, 1.2279377392624743e-6,
           8.308260894832433e-5, 0.00858474329309686, 0.20758996436563512,
           2.6296897472802944e-6, 0.12904181056710567]

    w3t = [0.00791133435075039, 0.03068870287979824, 0.010506523511630488,
           0.02748524016355353, 0.012276717412329111, 0.03341064876846345,
           1.6938875552451472e-8, 0.13984934627551662, 2.8727710165211805e-8,
           6.497794593560788e-7, 0.28782449943771365, 1.7895488098981285e-8,
           1.4092889813815445e-8, 0.12528285088799815, 8.15385421053231e-8,
           0.015084440027327891, 1.0645874759288279e-6, 0.19312474197164498,
           3.677285304090593e-8, 0.11655304397997937]

    w4t = [0.007920657427616102, 0.030668637277263787, 0.010500432216142167,
           0.02747291052000619, 0.012271335324959031, 0.03339309453273026,
           1.7288807624662253e-6, 0.1398419645980313, 2.9026467834348955e-6,
           6.137370886041355e-5, 0.2878082866151442, 1.846323615352377e-6,
           1.4383344416742414e-6, 0.12524860212395514, 7.99751837573715e-6,
           0.015077475176263464, 9.879305762316453e-5, 0.19309419174111606,
           3.645964678029406e-6, 0.11652268601163202]

    w5t = [0.01048532394724752, 0.027634726879025334, 0.0051582579275829595,
           0.014730229952227733, 0.001103482244495768, 0.025325763023433052,
           4.384456477310142e-7, 0.13424317043557146, 1.7339563286340342e-6,
           2.1982506028319674e-5, 0.3078546839507732, 6.580793426712629e-7,
           3.640388687087486e-7, 0.12812714403277226, 1.4335156330316576e-6,
           9.634755076943161e-5, 0.008584326247391505, 0.20759531561666966,
           3.0643263595912866e-6, 0.12903155332383157]

    w6t = [0.007912276028498588, 0.03068739129702337, 0.010506192497407309,
           0.027485028483134572, 0.012276222515655119, 0.033409090910730736,
           3.249731400617741e-8, 0.1398492533179084, 5.603190638552771e-8,
           1.2910163480371869e-6, 0.2878269787782013, 3.4634439698468525e-8,
           2.700961500511408e-8, 0.12528197755637782, 1.6021401021739912e-7,
           0.015084194534553572, 2.0950766101814892e-6, 0.19312511742067498,
           7.170574993871382e-8, 0.11655250847384091]

    w7t = [0.007909537753027565, 0.030689718350577398, 0.010506789965477385,
           0.027486764390401854, 0.012277520175790528, 0.03341133546948309,
           2.617329232431501e-8, 0.13984829600559406, 4.4230459246590174e-8,
           9.424763040433055e-7, 0.2878221557185522, 2.820077591940548e-8,
           2.1716548346074978e-8, 0.12528313527445484, 1.2191180284853197e-7,
           0.015085349377190905, 1.522123259037069e-6, 0.1931234266475917,
           5.56819599654295e-8, 0.1165532083574569]

    w8t = [0.0106793203131909, 0.027726987791365898, 0.005180570065945575,
           0.014799058588638557, 0.000784649034333424, 0.025359575887394795,
           3.220313139471539e-9, 0.1342540228303488, 1.280500100419102e-8,
           1.638717125456159e-7, 0.30782743677839197, 4.839549370542625e-9,
           2.6628669999359355e-9, 0.12811924110343037, 1.0537604757478401e-8,
           7.606041702616209e-7, 0.008636130250626367, 0.2075345596852565,
           2.2623233918688416e-8, 0.12909746650662487]

    w9t = [0.007911679037777465, 0.030687880266514474, 0.010506311702586786,
           0.027485403539680965, 0.01227647704061339, 0.033409490493939875,
           2.6682115652992533e-8, 0.13984901068132538, 4.5547612177824715e-8,
           1.041519305263547e-6, 0.2878258103183964, 2.826975509750448e-8,
           2.2117186811498898e-8, 0.125282514669305, 1.307277303484752e-7,
           0.015084405399031196, 1.684755413658061e-6, 0.19312497921276278,
           5.8065264411965765e-8, 0.1165529999536831]

    w10t = [0.007911813464310113, 0.03068510213747275, 0.010505366137939913,
            0.02748375285330511, 0.012276170276067139, 0.03340727036207522,
            3.968191684113028e-7, 0.1398469015680947, 6.62690268489184e-7,
            1.412505225860106e-5, 0.2878192785440307, 4.2200065419448415e-7,
            3.296864762413375e-7, 0.12527560333674628, 1.836077875288932e-6,
            0.015083599354027831, 2.2788913817547395e-5, 0.19311714086150886,
            8.333796539106878e-7, 0.11654660648424862]

    w11t = [0.007940343440459626, 0.030634853888863542, 0.010480246994367077,
            0.02746506524587317, 0.012245127022203104, 0.03334485036997602,
            3.500385774543004e-7, 0.13984265831460876, 9.094404090733543e-7,
            5.8228866272140154e-5, 0.2878742372792924, 4.0791092099686144e-7,
            2.783630539619788e-7, 0.1252635607495454, 4.520237197347675e-6,
            0.01506391038570315, 9.576531689175073e-5, 0.19312917261528162,
            1.5073402391213533e-6, 0.11655400618026439]

    w12t = [0.007913944192123943, 0.030686644757168525, 0.010505943512616245,
            0.027482860595190804, 0.01227550079106016, 0.03340909447152808,
            6.727234230874103e-8, 0.1398504049181077, 1.1409379093081019e-7,
            2.5848327948807787e-6, 0.2878269271229716, 7.106569666759467e-8,
            5.596594382439518e-8, 0.12528115149801963, 3.2389205332237693e-7,
            0.01508303840462458, 4.236310671918551e-6, 0.19312524915183676,
            1.4604815170247013e-7, 0.11655164110330649]

    w13t = [0.007920657427616102, 0.030668637277263787, 0.010500432216142167,
            0.02747291052000619, 0.012271335324959031, 0.03339309453273026,
            1.7288807624662253e-6, 0.1398419645980313, 2.9026467834348955e-6,
            6.137370886041355e-5, 0.2878082866151442, 1.846323615352377e-6,
            1.4383344416742414e-6, 0.12524860212395514, 7.99751837573715e-6,
            0.015077475176263464, 9.879305762316453e-5, 0.19309419174111606,
            3.645964678029406e-6, 0.11652268601163202]

    w14t = [0.007949498491646728, 0.03062225130426573, 0.010477563259287564,
            0.027458768148515687, 0.012239556732576276, 0.03333323672372583,
            4.381747243159045e-7, 0.13984112023857193, 1.132820086288224e-6,
            7.292905485153967e-5, 0.2878806653049824, 5.108095238294895e-7,
            3.497155080628157e-7, 0.1252575543601538, 5.661520843896587e-6,
            0.015060394731894257, 0.00011999425671139572, 0.19312762886413323,
            1.873887110975119e-6, 0.1165488716008864]

    w15t = [0.00791228013412238, 0.030687394726370946, 0.010506198733208223,
            0.027485029023934883, 0.012276227234412426, 0.033409100192360805,
            3.243957194907723e-8, 0.13984925366227294, 5.593719192947055e-8,
            1.2889290035776417e-6, 0.28782696825697424, 3.457465327246254e-8,
            2.696156009631406e-8, 0.12528197613242445, 1.5993563088092008e-7,
            0.015084199268025875, 2.0917845669297594e-6, 0.19312510993375798,
            7.158745406721865e-8, 0.11655250055250232]

    w16t = [0.007909537753027565, 0.030689718350577398, 0.010506789965477385,
            0.027486764390401854, 0.012277520175790528, 0.03341133546948309,
            2.617329232431501e-8, 0.13984829600559406, 4.4230459246590174e-8,
            9.424763040433055e-7, 0.2878221557185522, 2.820077591940548e-8,
            2.1716548346074978e-8, 0.12528313527445484, 1.2191180284853197e-7,
            0.015085349377190905, 1.522123259037069e-6, 0.1931234266475917,
            5.56819599654295e-8, 0.1165532083574569]

    w17t = [0.007912768239362008, 0.03068589410175436, 0.010503632047378112,
            0.02748597666548568, 0.01227380948028238, 0.03340490875896304,
            6.785740692047584e-9, 0.13984812074421996, 1.763443974091764e-8,
            1.1156911107698182e-6, 0.28782868561902863, 7.927804585452018e-9,
            5.395444887943042e-9, 0.12528456186279038, 8.755077943434774e-8,
            0.015083462593990876, 1.8179023224333371e-6, 0.19312706301782853,
            2.91361544588981e-8, 0.11655802884511897]

    w18t = [0.007911681006428787, 0.030687884412607648, 0.010506317269902865,
            0.027485405203177594, 0.012276481570885855, 0.033409499343754236,
            2.661162770283701e-8, 0.13984901021883692, 4.5428577096308894e-8,
            1.0388421856801797e-6, 0.28782579968591837, 2.8195595569036247e-8,
            2.2058781842574337e-8, 0.12528251469163784, 1.3038241624972517e-7,
            0.015084410075604746, 1.6804865540537504e-6, 0.19312497246888413,
            5.7914548521880095e-8, 0.11655299413207433]

    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t)
    @test isapprox(w3.weights, w3t, rtol = 1.0e-5)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t)
    @test isapprox(w6.weights, w6t, rtol = 1.0e-5)
    @test isapprox(w7.weights, w7t)
    @test isapprox(w8.weights, w8t)
    @test isapprox(w9.weights, w9t, rtol = 1.0e-5)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t)
    @test isapprox(w12.weights, w12t, rtol = 5.0e-5)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t)
    @test isapprox(w15.weights, w15t, rtol = 1.0e-5)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t)
    @test isapprox(w18.weights, w18t, rtol = 1.0e-5)
    @test isapprox(w0.weights, w1.weights)
    @test isapprox(w0.weights, w10.weights)
    @test isapprox(w1.weights, w10.weights)
    @test isapprox(w3.weights, w12.weights, rtol = 5.0e-5)
    @test isapprox(w7.weights, w16.weights, rtol = 1.0e-5)
    @test isapprox(w9.weights, w18.weights, rtol = 5.0e-5)
end

@testset "$(:Classic), $(:WC), $(:Utility)" begin
    portfolio = Portfolio(; prices = prices,
                          solvers = OrderedDict(:Clarabel => Dict(:solver => Clarabel.Optimizer,
                                                                  :params => Dict("verbose" => false,
                                                                                  "max_step_fraction" => 0.75))))
    asset_statistics!(portfolio)

    opt = OptimiseOpt(; rf = rf, l = l, class = :Classic, type = :Trad, rm = :SD,
                      obj = :Utility, kelly = :None)

    w0 = optimise!(portfolio, opt)

    wc_statistics!(portfolio, WCOpt(; box = :Normal, ellipse = :Normal, seed = 123456789))
    opt.type = :WC

    opt.u_cov = :None
    opt.u_mu = :None
    w1 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w2 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w3 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w4 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w5 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w6 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w7 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w8 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w9 = optimise!(portfolio, opt)
    wc_statistics!(portfolio, WCOpt(; box = :Delta, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w10 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w11 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w12 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w13 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w14 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w15 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w16 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w17 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w18 = optimise!(portfolio, opt)

    w1t = [1.8806825315287365e-9, 3.862038288374664e-9, 5.3002004387495145e-9,
           4.036002575991236e-9, 0.7741908142503021, 3.8445966380599916e-10,
           0.10998661007165159, 1.852701338887806e-9, 5.530542601292167e-9,
           1.7145172711134676e-9, 1.5657439073700846e-9, 4.404614975595981e-10,
           8.278998697027929e-10, 3.393489762947003e-10, 7.56536345977105e-10,
           0.11582251334241239, 1.8378733654274228e-8, 2.095243020357391e-9,
           1.0434852414339229e-8, 2.9356695212202287e-9]

    w2t = [2.805716182855447e-8, 6.08836560674535e-8, 1.0568078121539315e-7,
           6.412319419224896e-8, 0.7874637096101028, 8.774228637136583e-9,
           0.09194225139663352, 2.6192987734625515e-8, 9.665810121922179e-8,
           2.502489043857906e-8, 2.3372371214078192e-8, 8.255036261045137e-9,
           6.2570401010769666e-9, 1.3190093762174292e-8, 6.19853436271278e-9,
           0.12059116015354673, 1.957546955347339e-6, 2.9194381642424098e-8,
           3.771014356961893e-7, 4.232886722575466e-8]

    w3t = [6.1287401957144895e-9, 1.6600264922663634e-8, 2.3447374113734633e-8,
           1.4075572314106744e-8, 0.5625931869867452, 1.7302433621623164e-9,
           0.07157044656441465, 1.0915690928305488e-8, 1.7039838885407047e-8,
           6.498930430059676e-9, 9.074600922412826e-9, 1.4362938582831972e-9,
           1.062477380408395e-9, 3.132695925002502e-9, 1.0236833217506074e-9,
           0.14787249966208685, 0.17030744106482698, 1.1171674403867335e-8,
           0.04765628947400647, 1.2909839026694471e-8]

    w4t = [5.252194395056978e-9, 1.0315354940168556e-8, 9.455445139288418e-9,
           4.013209229711783e-9, 0.5819241901849773, 6.270890448664268e-10,
           2.0561433724117197e-9, 6.707564335612324e-9, 7.865563734245912e-9,
           4.17450063970948e-9, 1.0991695351988044e-8, 2.190782811533936e-10,
           1.1231785837732019e-10, 2.540524563038986e-9, 1.8113974061846706e-10,
           1.0750087695591245e-8, 0.4180755819596067, 1.2097725746430656e-8,
           1.273857143447765e-7, 1.3110067658773902e-8]

    w5t = [7.450617569435218e-8, 1.691770721106442e-7, 1.5674713909543173e-7,
           5.366042775942177e-8, 0.5520776394586348, 1.841614638968509e-8,
           2.9069631672507916e-8, 9.268404826263314e-8, 1.0485330110287837e-7,
           5.446057054512299e-8, 1.895901900882436e-7, 1.1836606212753126e-8,
           6.95050328547548e-9, 3.6737651102745956e-8, 8.326868461141755e-9,
           1.4663521610097443e-7, 0.4479156448057725, 2.156962163971092e-7,
           5.09262226349376e-6, 2.5376556505840216e-7]

    w6t = [1.4359419266226849e-9, 3.958537256499743e-9, 2.875796074067922e-9,
           1.08084259415127e-9, 0.399750018957966, 3.6738324940551096e-10,
           5.213193956534155e-10, 4.728337071388599e-9, 1.5810062504266924e-9,
           1.2336050669381269e-9, 0.032982827875995976, 2.0352257205975656e-10,
           1.1531933156626026e-10, 8.546392990565349e-10, 1.392254191169641e-10,
           6.206899064553828e-9, 0.4425932916766414, 4.1524798028839716e-8,
           0.12467378247584977, 1.2186374270681762e-8]

    w7t = [0.004693559535696298, 0.03169836414353014, 0.012129963693490453,
           0.02810771359920514, 0.018929326967469445, 0.02365548343019867,
           1.416370073509333e-8, 0.13876997110144645, 2.323474509790528e-8,
           9.068461606296569e-7, 0.2889430629754589, 1.2659952189571197e-8,
           9.679831617647037e-9, 0.1208800359878905, 3.857204496070787e-8,
           0.017059830307440405, 0.003165472335125628, 0.19500289259819398,
           3.051901201819313e-8, 0.11696328764940682]

    w8t = [0.004707791908313307, 0.03168011994609544, 0.012095944726989702,
           0.028033630599675872, 0.01885841423373504, 0.02360951845095849,
           4.0626950809622554e-10, 0.13873732502021116, 7.218091111592758e-10,
           4.018727221266184e-8, 0.28906033496867306, 4.1736222453697224e-10,
           2.9349382618453563e-10, 0.12089400398468353, 1.1087628576980659e-9,
           0.016965121620385534, 0.0032370161940386464, 0.19508381163883784,
           9.29598823459994e-10, 0.11703692264283394]

    w9t = [0.004707923599038641, 0.0316964930628123, 0.012124813940426128,
           0.02810634274907386, 0.01890344561651571, 0.02369551654930665,
           1.1935139396960778e-10, 0.1387748488731172, 1.956835380808421e-10,
           8.379749834200534e-9, 0.2889392189155884, 1.0446745420970892e-10,
           7.976765780690326e-11, 0.12090016997826193, 3.3478082843903474e-10,
           0.01705249576105973, 0.003136821692155628, 0.1949978626855397,
           2.5566045489880193e-10, 0.11696403710764305]

    w10t = [1.8806825315287365e-9, 3.862038288374664e-9, 5.3002004387495145e-9,
            4.036002575991236e-9, 0.7741908142503021, 3.8445966380599916e-10,
            0.10998661007165159, 1.852701338887806e-9, 5.530542601292167e-9,
            1.7145172711134676e-9, 1.5657439073700846e-9, 4.404614975595981e-10,
            8.278998697027929e-10, 3.393489762947003e-10, 7.56536345977105e-10,
            0.11582251334241239, 1.8378733654274228e-8, 2.095243020357391e-9,
            1.0434852414339229e-8, 2.9356695212202287e-9]

    w11t = [9.404652325727814e-9, 1.719868515706557e-8, 2.8483182803795e-8,
            1.853177179679032e-8, 0.7565390342554569, 3.9972899878833765e-9,
            0.1059280993027199, 8.974718284349187e-9, 2.6157918994097238e-8,
            8.638697017100152e-9, 8.226099866073654e-9, 3.841004767255786e-9,
            3.0219011228410342e-9, 5.4547626890407746e-9, 3.0225617033537158e-9,
            0.13753218743600373, 4.178744252926253e-7, 9.656312612804123e-9,
            9.37669381383348e-8, 1.2754897051566412e-8]

    w12t = [1.5352939129562205e-9, 4.167306183091875e-9, 5.8868857202205285e-9,
            3.529975670562331e-9, 0.5618467208022726, 4.3314350972295895e-10,
            0.07143807013825593, 2.7455852715219727e-9, 4.257945035269977e-9,
            1.628632030125331e-9, 2.2808359091537375e-9, 3.593915543766332e-10,
            2.6589385415183863e-10, 7.847033576222356e-10, 2.5615659200864535e-10,
            0.1477953086387725, 0.17074650618722775, 2.8073555556422837e-9,
            0.04817336005266399, 3.241703306374346e-9]

    w13t = [3.647902119428961e-10, 2.1977715335790454e-9, 4.064170032796999e-9,
            2.3972232748394194e-9, 0.75478163814755, 1.0679235246725186e-9,
            0.10551594374842024, 3.776810262001307e-10, 4.357820292261647e-9,
            2.573044832077191e-10, 2.0018803785122081e-10, 1.0995315175089325e-9,
            1.220582723514187e-9, 6.127953723783301e-10, 1.2973729020478185e-9,
            0.13970233618556752, 4.547259952804259e-8, 5.552311979866896e-10,
            1.5145933671581878e-8, 1.229542917036613e-9]

    w14t = [2.5072209766309822e-8, 6.524666595724082e-8, 1.1896052969985183e-7,
            6.909663326699326e-8, 0.7308742850376809, 7.212472757491972e-9,
            0.10068813093051053, 2.254831575050526e-8, 1.132357089583602e-7,
            2.1019738015053924e-8, 1.9730851398734935e-8, 6.8360481915692516e-9,
            5.105795130626096e-9, 1.0818491016554973e-8, 5.1298284977106645e-9,
            0.15517673273094307, 0.013259494231541139, 2.554183563971588e-8,
            8.004181652842922e-7, 4.109603501203217e-8]

    w15t = [1.6780275913002397e-9, 6.85569672168983e-9, 1.038730443092044e-8,
            5.299793219579988e-9, 0.5204799421556242, 3.683880003210039e-10,
            0.0640813929331314, 4.022321003685694e-9, 5.064272961880185e-9,
            1.6869179017488482e-9, 2.93117714872067e-9, 3.076465351165329e-10,
            2.2311295055283944e-10, 6.919081299186971e-10, 2.1888419829610774e-10,
            0.14351822990392982, 0.19507140628373346, 3.969547300932198e-9,
            0.07684897998197343, 5.036609397106666e-9]

    w16t = [0.004693559535696298, 0.03169836414353014, 0.012129963693490453,
            0.02810771359920514, 0.018929326967469445, 0.02365548343019867,
            1.416370073509333e-8, 0.13876997110144645, 2.323474509790528e-8,
            9.068461606296569e-7, 0.2889430629754589, 1.2659952189571197e-8,
            9.679831617647037e-9, 0.1208800359878905, 3.857204496070787e-8,
            0.017059830307440405, 0.003165472335125628, 0.19500289259819398,
            3.051901201819313e-8, 0.11696328764940682]

    w17t = [0.0046955602265058944, 0.031698161040036414, 0.012129300728711294,
            0.028107560389739304, 0.018925793165114585, 0.023661130527665806,
            7.104470412860531e-10, 0.13877067084223482, 1.2740019824226756e-9,
            4.011680348196579e-8, 0.28894257170834287, 7.56586379265296e-10,
            5.400262935892111e-10, 0.1208828839751937, 1.6026111766150435e-9,
            0.017058925608254904, 0.0031616809491263253, 0.19500227342351797,
            1.6795600363929142e-9, 0.11696344073551983]

    w18t = [0.004707985581158575, 0.03169648428387281, 0.012124791671787503,
            0.028106336383555114, 0.018903335882791555, 0.02369568466404512,
            1.196926501934307e-10, 0.13877486912937181, 1.9624929131695483e-10,
            8.402644286958882e-9, 0.28893920199860446, 1.0478043766652707e-10,
            8.000669029578242e-11, 0.12090025371098266, 3.356801389640301e-10,
            0.017052464401642663, 0.0031367037319682896, 0.19499784007543003,
            2.564025995814622e-10, 0.1169640389893333]

    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t)
    @test isapprox(w3.weights, w3t, rtol = 1.0e-5)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t)
    @test isapprox(w6.weights, w6t, rtol = 5.0e-5)
    @test isapprox(w7.weights, w7t)
    @test isapprox(w8.weights, w8t)
    @test isapprox(w9.weights, w9t, rtol = 1.0e-5)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t)
    @test isapprox(w12.weights, w12t, rtol = 1.0e-5)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t)
    @test isapprox(w15.weights, w15t, rtol = 1.0e-5)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t)
    @test isapprox(w18.weights, w18t, rtol = 1.0e-5)
    @test isapprox(w0.weights, w1.weights)
    @test isapprox(w0.weights, w10.weights)
    @test isapprox(w1.weights, w10.weights)
    @test !isapprox(w3.weights, w12.weights)
    @test isapprox(w7.weights, w16.weights)
    @test !isapprox(w9.weights, w18.weights)
end

@testset "$(:Classic), $(:WC), $(:Sharpe)" begin
    portfolio = Portfolio(; prices = prices,
                          solvers = OrderedDict(:Clarabel => Dict(:solver => Clarabel.Optimizer,
                                                                  :params => Dict("verbose" => false,
                                                                                  "max_step_fraction" => 0.75))))
    asset_statistics!(portfolio)

    opt = OptimiseOpt(; rf = rf, l = l, class = :Classic, type = :Trad, rm = :SD,
                      obj = :Sharpe, kelly = :None)

    w0 = optimise!(portfolio, opt)

    opt.type = :WC
    wc_statistics!(portfolio, WCOpt(; box = :Normal, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w1 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w2 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w3 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w4 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w5 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w6 = optimise!(portfolio, opt)
    wc_statistics!(portfolio, WCOpt(; box = :Delta, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w10 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w11 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w12 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w13 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w14 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w15 = optimise!(portfolio, opt)
    opt.kelly = :Approx
    opt.u_cov = :None
    opt.u_mu = :None
    w16 = optimise!(portfolio, opt)
    opt.kelly = :Exact
    w17 = optimise!(portfolio, opt)

    w1t = [1.0582219191763675e-9, 3.033341281368263e-9, 4.093973467616387e-9,
           2.4302432491378547e-9, 0.518058049464457, 3.284428917099043e-10,
           0.06365095369119145, 2.483269319093602e-9, 2.345993206888518e-9,
           1.1710759933582023e-9, 1.9667796025518083e-9, 2.6638354190663204e-10,
           1.933888387868567e-10, 5.926494610003628e-10, 1.8755971351419546e-10,
           0.143267787756283, 0.19649630246514146, 2.335142195851285e-9,
           0.07852688169059606, 2.4458664972621787e-9]

    w2t = [2.8412816525478146e-8, 0.00035196294061108315, 1.3052329509733161e-6,
           2.87254720878552e-7, 0.2666085608412865, 3.066695991497784e-9,
           0.011445317506056641, 0.06657588647768221, 4.956539340550331e-8,
           4.942883684369277e-8, 0.1613717386465365, 1.9418616900887073e-9,
           1.3645330112497187e-9, 1.1146847727603151e-8, 1.4308219462717556e-9,
           0.07263796658744098, 0.2016984496157288, 0.10136663350490349,
           0.08771684891228358, 0.030224896121991304]

    w3t = [2.741752771232368e-8, 0.007778904221373229, 0.003865387033729693,
           0.00275436998675274, 0.25098868961721904, 6.5758296742028075e-9,
           0.023160055275138897, 0.08562675679527881, 3.5172853510056145e-8,
           3.828672042251561e-8, 0.16235439019224968, 4.2423745198761e-9,
           2.98601782482673e-9, 1.7861890219250772e-8, 3.2217645322454144e-9,
           0.08334187156775032, 0.16534808624834177, 0.10482674192356113,
           0.0755298920860633, 0.03442471928756293]

    w4t = [6.466684324776656e-11, 8.516807283687845e-11, 9.472315022300327e-11,
           5.1957167657756756e-11, 0.9999999985074259, 2.0192854664051626e-11,
           3.436252425053897e-11, 5.149260592067322e-11, 7.462642590762538e-11,
           4.561655322527492e-11, 6.186767722266438e-11, 1.3899284282467578e-11,
           7.750637790067232e-12, 3.337064177968372e-11, 9.659444439315246e-12,
           7.302466718285475e-11, 4.5866872942896926e-10, 7.012474376020365e-11,
           1.5414496160965011e-10, 8.72570588192862e-11]

    w5t = [1.9409089548743477e-10, 3.1564619696752674e-10, 3.25738141555929e-10,
           1.5005563626271312e-10, 0.7008304542355122, 5.069791714974362e-11,
           8.841751111869289e-11, 1.8416820618235487e-10, 2.578481887264228e-10,
           1.4192124066866055e-10, 2.5722874917391247e-10, 3.295120542776688e-11,
           1.8052557212010085e-11, 9.760762013674915e-11, 2.1941995624520676e-11,
           2.8101096518769044e-10, 0.29916954115599875, 2.9589738294333433e-10,
           1.536051217227758e-9, 3.591635066988638e-10]

    w6t = [8.510713846948011e-10, 1.368572518070052e-9, 1.3689181260651854e-9,
           6.742689269063031e-10, 0.6864094871923422, 2.4840237233488856e-10,
           4.0753201323440513e-10, 8.654433854616809e-10, 1.1359840534073957e-9,
           6.560742774525492e-10, 1.1960355956232209e-9, 1.5955467508887177e-10,
           9.026932481707672e-11, 4.634725902256178e-10, 1.0920613051971341e-10,
           1.2900040474594334e-9, 0.31359049323435206, 1.3430106933086768e-9,
           5.795333258966763e-9, 1.5501524052292743e-9]

    w10t = [1.0582219191763675e-9, 3.033341281368263e-9, 4.093973467616387e-9,
            2.4302432491378547e-9, 0.518058049464457, 3.284428917099043e-10,
            0.06365095369119145, 2.483269319093602e-9, 2.345993206888518e-9,
            1.1710759933582023e-9, 1.9667796025518083e-9, 2.6638354190663204e-10,
            1.933888387868567e-10, 5.926494610003628e-10, 1.8755971351419546e-10,
            0.143267787756283, 0.19649630246514146, 2.335142195851285e-9,
            0.07852688169059606, 2.4458664972621787e-9]

    w11t = [1.2956131060418805e-8, 0.007766319902530555, 0.0038698884729426297,
            0.0027575452131157895, 0.25099632102291025, 1.858344145755973e-9,
            0.02315866528942557, 0.08562254546821742, 2.5174951275929287e-8,
            2.232352055014575e-8, 0.16236982155031543, 1.202395823623793e-9,
            8.423879654324937e-10, 5.821294294758675e-9, 9.014353926181081e-10,
            0.08334324969810843, 0.1653508499370702, 0.10483367172634506,
            0.07552186008510518, 0.03440919055345298]

    w12t = [2.7329549116578712e-8, 0.007778898999498371, 0.003865373309855434,
            0.0027543603786038336, 0.2509887073796333, 6.554161363581734e-9,
            0.023160058083709988, 0.08562675351661912, 3.50614471022181e-8,
            3.8163644520678944e-8, 0.1623543833044971, 4.228333647675614e-9,
            2.9760480485219615e-9, 1.7803653141933662e-8, 3.2110254078824952e-9,
            0.08334187391811375, 0.16534809215646107, 0.10482674265989549,
            0.07552989734371146, 0.03442472362153882]

    w13t = [7.86104680168596e-11, 2.581689370363608e-10, 3.751927152447362e-10,
            2.1247028587508447e-10, 0.523634883488626, 1.9486433116903062e-11,
            0.06464274713780861, 1.549689208956321e-10, 2.0554803821712053e-10,
            7.975947674723269e-11, 1.2077742964126379e-10, 1.6434493809377638e-11,
            1.1964486515368817e-11, 3.6573008241479916e-11, 1.0468424536562565e-11,
            0.14384439793458836, 0.19321690478313466, 1.5557988191105592e-10,
            0.07466106472997303, 1.898664279910272e-10]

    w14t = [1.2263904439118016e-8, 0.007060252113352363, 0.0036540730976423025,
            0.0021522184115763767, 0.2551009198991718, 1.1756276183234802e-9,
            0.023705335955290292, 0.08460251834282648, 2.3885920274456877e-8,
            2.0788888043866e-8, 0.15915641603733602, 7.943942762030404e-10,
            5.310613607982868e-10, 3.797525765151979e-9, 5.674070944570201e-10,
            0.08446004253353889, 0.16761618932791755, 0.10250681464525724,
            0.07714491088562073, 0.03284024494574102]

    w15t = [9.810815466152289e-9, 0.007071976009969929, 0.00365173823819271,
            0.0021478108762156057, 0.2550935967489524, 1.8640654683717285e-9,
            0.023706572439827375, 0.08460583256397154, 1.3674932676978091e-8,
            1.357064101943576e-8, 0.1591439736845676, 1.262940520015059e-9,
            8.878675200488327e-10, 5.039094129557091e-9, 9.412599414346414e-10,
            0.08445861354297991, 0.16761336235774132, 0.10250140721054403,
            0.07715035042874414, 0.03285471884667695]

    w16t = [1.8936023733971716e-7, 7.759755252629935e-7, 1.030806203991613e-6,
            4.859440578422584e-7, 0.45249930505411073, 5.660324801246874e-8,
            0.05199219525670206, 2.6247324027201767e-6, 3.080955476028156e-7,
            2.2165249031163672e-7, 9.981959921562277e-7, 4.3163677394287155e-8,
            3.194465829791772e-8, 1.0930201332601899e-7, 3.1218211513058067e-8,
            0.13648884753629192, 0.2350440113219722, 9.922895023025335e-7,
            0.1239670381377456, 7.034094093603752e-7]

    w17t = [2.0184456345048768e-8, 6.618692139937966e-8, 8.648692815426136e-8,
            4.760981393989345e-8, 0.48941508879975115, 6.2929759532963e-9,
            0.05833663800209291, 6.853354731936131e-8, 4.458883181890003e-8,
            2.298252674522769e-8, 4.96139104169387e-8, 5.101272720052931e-9,
            3.722385516976071e-9, 1.1484275309689927e-8, 3.614760596055875e-9,
            0.140325949013441, 0.21337780603089268, 5.831498491601652e-8,
            0.09854396946956434, 5.3966666897345284e-8]
    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t, rtol = 1.0e-6)
    @test isapprox(w3.weights, w3t, rtol = 1e-7)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t, rtol = 1.0e-6)
    @test isapprox(w6.weights, w6t, rtol = 1.0e-6)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t, rtol = 1.0e-6)
    @test isapprox(w12.weights, w12t, rtol = 1e-7)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t, rtol = 1.0e-5)
    @test isapprox(w15.weights, w15t, rtol = 1.0e-5)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t, rtol = 1.0e-5)
    @test isapprox(w0.weights, w1.weights, rtol = 1.0e-7)
    @test isapprox(w0.weights, w10.weights, rtol = 1.0e-7)
    @test isapprox(w1.weights, w10.weights)
    @test isapprox(w3.weights, w12.weights, rtol = 1.0e-7)
end

@testset "$(:Classic), $(:WC), $(:Max_Ret)" begin
    portfolio = Portfolio(; prices = prices,
                          solvers = OrderedDict(:Clarabel => Dict(:solver => Clarabel.Optimizer,
                                                                  :params => Dict("verbose" => false,
                                                                                  "max_step_fraction" => 0.75))))
    asset_statistics!(portfolio)

    opt = OptimiseOpt(; rf = rf, l = l, class = :Classic, type = :Trad, rm = :SD,
                      obj = :Max_Ret, kelly = :None)

    w0 = optimise!(portfolio, opt)

    wc_statistics!(portfolio, WCOpt(; box = :Normal, ellipse = :Normal, seed = 123456789))
    opt.type = :WC

    opt.u_cov = :None
    opt.u_mu = :None
    w1 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w2 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w3 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w4 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w5 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w6 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w7 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w8 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w9 = optimise!(portfolio, opt)
    wc_statistics!(portfolio, WCOpt(; box = :Delta, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w10 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w11 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w12 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w13 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w14 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w15 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w16 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w17 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w18 = optimise!(portfolio, opt)

    w1t = [2.242587206880573e-8, 2.3869345719665024e-8, 3.0249972077364615e-8,
           2.7441036414624337e-8, 2.674016473443787e-6, 1.111794542964317e-8,
           0.999996954927899, 1.6603745204232977e-8, 2.5223224543701134e-8,
           1.8088400369515617e-8, 1.6172380723211374e-8, 1.16166386268502e-8,
           8.681387038232673e-9, 1.3771962838160079e-8, 8.992921449936008e-9,
           4.039243448317557e-8, 3.1600448893350835e-8, 1.7426103715815354e-8,
           2.6166436902355393e-8, 2.121537093958793e-8]

    w2t = [6.989037895383436e-8, 7.480538211882142e-8, 9.691293470711082e-8,
           8.678037210737846e-8, 8.837803088408388e-6, 3.40581564078145e-8,
           0.999989993339588, 5.0910247631747685e-8, 7.956894828568414e-8,
           5.5670422521762763e-8, 4.9439177610106315e-8, 3.572433741796514e-8,
           2.7230914956887026e-8, 4.200273372251963e-8, 2.7981881709706302e-8,
           1.336944045080762e-7, 1.019575350256201e-7, 5.343621688355654e-8,
           8.291247355406826e-8, 6.588080521189712e-8]

    w3t = [7.557372704850142e-10, 8.076781859187979e-10, 1.0443144901794161e-9,
           9.359407831933607e-10, 1.0872408137093332e-7, 3.781875162505833e-10,
           0.9999998785798624, 5.560321088908308e-10, 8.594595880704991e-10,
           6.066737657017057e-10, 5.405772599751212e-10, 3.9671163148841167e-10,
           3.045445744104052e-10, 4.6277800455644614e-10, 3.1254438493813085e-10,
           1.4463379303525595e-9, 1.098310294989877e-9, 5.825488048495518e-10,
           8.944332426714367e-10, 7.132463363314155e-10]

    w4t = [4.2042049734727806e-8, 4.521518897189257e-8, 5.659006070667893e-8,
           3.514877814292186e-8, 0.9999993010578468, 1.5765085402586468e-8,
           2.7221728971256205e-8, 2.833331125793981e-8, 4.0442398566396016e-8,
           2.820564078004165e-8, 3.015401882144552e-8, 1.3622176589629896e-8,
           8.610124539098548e-9, 2.1881580106619616e-8, 1.0054344351204034e-8,
           3.857715060414015e-8, 1.2018663273637416e-7, 3.337382833665426e-8,
           5.928283670571385e-8, 4.42352177893344e-8]

    w5t = [9.377415466609279e-8, 1.0272420517112992e-7, 1.2379069963449228e-7,
           7.88908877064689e-8, 0.9999984542188851, 3.381052043433265e-8,
           6.063461327909876e-8, 6.528284321580322e-8, 9.272801754761999e-8,
           6.438645876637771e-8, 7.101071935434272e-8, 2.8462432632992756e-8,
           1.7554303492159786e-8, 4.916101198170805e-8, 2.050205062361616e-8,
           8.907634792253174e-8, 2.403215484938327e-7, 7.852171953659121e-8,
           1.338002068689107e-7, 1.0134837351440007e-7]

    w6t = [5.625466722347094e-11, 6.205759795810088e-11, 7.574727528721409e-11,
           4.673261003628035e-11, 0.9999999990746032, 1.9236659513414705e-11,
           3.540535381787307e-11, 3.8122510959053476e-11, 5.5572089269728423e-11,
           3.756758642544284e-11, 4.175945668369203e-11, 1.631064138152141e-11,
           9.991904223580483e-12, 2.8251914269238797e-11, 1.1690030274220593e-11,
           5.333084368188005e-11, 1.4743061474199397e-10, 4.651918866482874e-11,
           8.220798782881751e-11, 6.120777507566042e-11]

    w7t = [0.0046735070425663735, 0.03170121824101793, 0.01213716074983744,
           0.02810977204653443, 0.018964809982631864, 0.023601128417289938,
           1.375161919996681e-8, 0.1387634338017016, 2.3003239765602847e-8,
           9.093158844921919e-7, 0.28894852047345526, 1.2276164956778786e-8,
           9.266122250298356e-9, 0.12085297997684766, 3.818705754876103e-8,
           0.017069960471799112, 0.003203549288602372, 0.19501021778745717,
           3.03327764807958e-8, 0.1169627055873943]

    w8t = [0.004673537976946855, 0.03170119544530013, 0.01213714609193213,
           0.02810975710229446, 0.018964798825338226, 0.02360110244927592,
           1.5311406906793862e-8, 0.13876342534331398, 2.5457054812217364e-8,
           1.0145275461479218e-6, 0.28894850437880626, 1.3594040998092532e-8,
           1.0339386512133851e-8, 0.12085294737121205, 4.234460118028566e-8,
           0.017069948910425726, 0.003203622706852751, 0.1950101843139241,
           3.349925843049369e-8, 0.11696267401108237]

    w9t = [0.004673244817190372, 0.03170139396261079, 0.012137270934126525,
           0.028109884440479575, 0.018964905446944652, 0.023601322132116985,
           2.3690055506863073e-9, 0.1387634986487497, 3.872188777363404e-9,
           1.5339587504398632e-7, 0.288948634807124, 2.080972367542935e-9,
           1.5953934172609717e-9, 0.12085322415240292, 6.4846917818404995e-9,
           0.01707004331543968, 0.0032029825571973755, 0.1950104752320347,
           5.056451116475305e-9, 0.11696294469900465]

    w10t = [2.242587206880573e-8, 2.3869345719665024e-8, 3.0249972077364615e-8,
            2.7441036414624337e-8, 2.674016473443787e-6, 1.111794542964317e-8,
            0.999996954927899, 1.6603745204232977e-8, 2.5223224543701134e-8,
            1.8088400369515617e-8, 1.6172380723211374e-8, 1.16166386268502e-8,
            8.681387038232673e-9, 1.3771962838160079e-8, 8.992921449936008e-9,
            4.039243448317557e-8, 3.1600448893350835e-8, 1.7426103715815354e-8,
            2.6166436902355393e-8, 2.121537093958793e-8]

    w11t = [6.989037895383436e-8, 7.480538211882142e-8, 9.691293470711082e-8,
            8.678037210737846e-8, 8.837803088408388e-6, 3.40581564078145e-8,
            0.999989993339588, 5.0910247631747685e-8, 7.956894828568414e-8,
            5.5670422521762763e-8, 4.9439177610106315e-8, 3.572433741796514e-8,
            2.7230914956887026e-8, 4.200273372251963e-8, 2.7981881709706302e-8,
            1.336944045080762e-7, 1.019575350256201e-7, 5.343621688355654e-8,
            8.291247355406826e-8, 6.588080521189712e-8]

    w12t = [7.557372704850142e-10, 8.076781859187979e-10, 1.0443144901794161e-9,
            9.359407831933607e-10, 1.0872408137093332e-7, 3.781875162505833e-10,
            0.9999998785798624, 5.560321088908308e-10, 8.594595880704991e-10,
            6.066737657017057e-10, 5.405772599751212e-10, 3.9671163148841167e-10,
            3.045445744104052e-10, 4.6277800455644614e-10, 3.1254438493813085e-10,
            1.4463379303525595e-9, 1.098310294989877e-9, 5.825488048495518e-10,
            8.944332426714367e-10, 7.132463363314155e-10]

    w13t = [2.2157629001814043e-8, 2.3705206178889556e-8, 3.1337524512027466e-8,
            2.7822239462468775e-8, 3.817602380688397e-6, 1.0845455226582203e-8,
            0.9999958072350622, 1.6162961145208927e-8, 2.5262648251923497e-8,
            1.7620900422092873e-8, 1.572567737326121e-8, 1.129544407446688e-8,
            8.418152681037229e-9, 1.3392424290139792e-8, 8.742579157457356e-9,
            4.5537115159563596e-8, 3.30644482886816e-8, 1.6950167741040277e-8,
            2.6312815513451374e-8, 2.0809168671644914e-8]

    w14t = [6.18672522752248e-8, 6.660463315847458e-8, 9.006687455402096e-8,
            7.887070495555246e-8, 1.089918703360366e-5, 3.042154927163067e-8,
            0.999988034157972, 4.4828590574552585e-8, 7.135787933478868e-8,
            4.8960556991011206e-8, 4.3562684666504686e-8, 3.1867139337999185e-8,
            2.4373219474750287e-8, 3.7212092126252046e-8, 2.5047494973655907e-8,
            1.3578505229067643e-7, 9.590392555704405e-8, 4.701335158291311e-8,
            7.47932751792461e-8, 5.811871818279355e-8]

    w15t = [1.6473368419194557e-10, 1.7708134777297242e-10, 2.365287112340073e-10,
            2.0855215628975245e-10, 3.179214940346995e-8, 8.154344424476778e-11,
            0.9999999653864595, 1.1953389810125478e-10, 1.8950566028451338e-10,
            1.3057991897141793e-10, 1.1617718189699146e-10, 8.541587833245962e-11,
            6.535526970523187e-11, 9.946899518009342e-11, 6.716922485496374e-11,
            3.504354454865942e-10, 2.509456070871149e-10, 1.2533178649674817e-10,
            1.9819431268964927e-10, 1.548383847574431e-10]

    w16t = [0.0046735070425663735, 0.03170121824101793, 0.01213716074983744,
            0.02810977204653443, 0.018964809982631864, 0.023601128417289938,
            1.375161919996681e-8, 0.1387634338017016, 2.3003239765602847e-8,
            9.093158844921919e-7, 0.28894852047345526, 1.2276164956778786e-8,
            9.266122250298356e-9, 0.12085297997684766, 3.818705754876103e-8,
            0.017069960471799112, 0.003203549288602372, 0.19501021778745717,
            3.03327764807958e-8, 0.1169627055873943]

    w17t = [0.004673537976946855, 0.03170119544530013, 0.01213714609193213,
            0.02810975710229446, 0.018964798825338226, 0.02360110244927592,
            1.5311406906793862e-8, 0.13876342534331398, 2.5457054812217364e-8,
            1.0145275461479218e-6, 0.28894850437880626, 1.3594040998092532e-8,
            1.0339386512133851e-8, 0.12085294737121205, 4.234460118028566e-8,
            0.017069948910425726, 0.003203622706852751, 0.1950101843139241,
            3.349925843049369e-8, 0.11696267401108237]

    w18t = [0.004673244817190372, 0.03170139396261079, 0.012137270934126525,
            0.028109884440479575, 0.018964905446944652, 0.023601322132116985,
            2.3690055506863073e-9, 0.1387634986487497, 3.872188777363404e-9,
            1.5339587504398632e-7, 0.288948634807124, 2.080972367542935e-9,
            1.5953934172609717e-9, 0.12085322415240292, 6.4846917818404995e-9,
            0.01707004331543968, 0.0032029825571973755, 0.1950104752320347,
            5.056451116475305e-9, 0.11696294469900465]

    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t)
    @test isapprox(w3.weights, w3t)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t)
    @test isapprox(w6.weights, w6t)
    @test isapprox(w7.weights, w7t)
    @test isapprox(w8.weights, w8t)
    @test isapprox(w9.weights, w9t)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t)
    @test isapprox(w12.weights, w12t)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t)
    @test isapprox(w15.weights, w15t)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t)
    @test isapprox(w18.weights, w18t)
    @test isapprox(w0.weights, w1.weights)
    @test isapprox(w0.weights, w10.weights)
    @test isapprox(w1.weights, w10.weights)
    @test isapprox(w3.weights, w12.weights)
    @test isapprox(w7.weights, w16.weights)
    @test isapprox(w9.weights, w18.weights)
end
