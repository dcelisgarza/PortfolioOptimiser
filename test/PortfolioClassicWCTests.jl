using COSMO, CSV, Clarabel, HiGHS, LinearAlgebra, OrderedCollections, PortfolioOptimiser,
      Statistics, Test, TimeSeries, SCS

prices = TimeArray(CSV.File("./assets/stock_prices.csv"); timestamp = :date)

rf = 1.0329^(1 / 252) - 1
l = 2.0

@testset "$(:Classic), $(:WC), $(:Min_Risk)" begin
    portfolio = Portfolio(; prices = prices,
                          solvers = OrderedDict(:Clarabel => Dict(:solver => Clarabel.Optimizer,
                                                                  :params => Dict("verbose" => false,
                                                                                  "max_step_fraction" => 0.75)),
                                                :COSMO => Dict(:solver => COSMO.Optimizer,
                                                               :params => Dict("verbose" => false))))
    asset_statistics!(portfolio)

    opt = OptimiseOpt(; rf = rf, l = l, class = :Classic, type = :Trad, rm = :SD,
                      obj = :Min_Risk, kelly = :None)

    w0 = optimise!(portfolio, opt)

    wc_statistics!(portfolio, WCOpt(; box = :Normal, ellipse = :Normal, seed = 123456789))
    opt.type = :WC

    opt.u_cov = :None
    opt.u_mu = :None
    w1 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w2 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w3 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w4 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w5 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w6 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w7 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w8 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w9 = optimise!(portfolio, opt)
    wc_statistics!(portfolio, WCOpt(; box = :Delta, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w10 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w11 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w12 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w13 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w14 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w15 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w16 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w17 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w18 = optimise!(portfolio, opt)

    w1t = [0.007911813464310113, 0.03068510213747275, 0.010505366137939913,
           0.02748375285330511, 0.012276170276067139, 0.03340727036207522,
           3.968191684113028e-7, 0.1398469015680947, 6.62690268489184e-7,
           1.412505225860106e-5, 0.2878192785440307, 4.2200065419448415e-7,
           3.296864762413375e-7, 0.12527560333674628, 1.836077875288932e-6,
           0.015083599354027831, 2.2788913817547395e-5, 0.19311714086150886,
           8.333796539106878e-7, 0.11654660648424862]

    w2t = [0.010505262318488156, 0.02765001122547157, 0.005155696156015236,
           0.014740124727805618, 0.0010683067258207021, 0.025331092034838153,
           3.754513875090486e-7, 0.13424546801820192, 1.4866284657155555e-6,
           1.889293371471046e-5, 0.30785174082434547, 5.633771366027783e-7,
           3.110414526626435e-7, 0.12812721007458353, 1.2279377392624743e-6,
           8.308260894832433e-5, 0.00858474329309686, 0.20758996436563512,
           2.6296897472802944e-6, 0.12904181056710567]

    w3t = [0.03334306392629812, 0.04378838741607847, 0.023441303652430783,
           0.022920791171853576, 0.018699247761822073, 0.06451664206152088,
           1.0145969311087692e-8, 0.12485446291476845, 3.1749059209110065e-8,
           0.02757557212881489, 0.2054821046260904, 1.2560352170382212e-8,
           1.3168578609547878e-8, 0.11301701924719756, 0.004802061842329558,
           0.021831176806415935, 0.04448711415519218, 0.15164582478565117,
           0.005662971174324261, 0.09393218870525252]

    w4t = [0.007920657427616102, 0.030668637277263787, 0.010500432216142167,
           0.02747291052000619, 0.012271335324959031, 0.03339309453273026,
           1.7288807624662253e-6, 0.1398419645980313, 2.9026467834348955e-6,
           6.137370886041355e-5, 0.2878082866151442, 1.846323615352377e-6,
           1.4383344416742414e-6, 0.12524860212395514, 7.99751837573715e-6,
           0.015077475176263464, 9.879305762316453e-5, 0.19309419174111606,
           3.645964678029406e-6, 0.11652268601163202]

    w5t = [0.01048532394724752, 0.027634726879025334, 0.0051582579275829595,
           0.014730229952227733, 0.001103482244495768, 0.025325763023433052,
           4.384456477310142e-7, 0.13424317043557146, 1.7339563286340342e-6,
           2.1982506028319674e-5, 0.3078546839507732, 6.580793426712629e-7,
           3.640388687087486e-7, 0.12812714403277226, 1.4335156330316576e-6,
           9.634755076943161e-5, 0.008584326247391505, 0.20759531561666966,
           3.0643263595912866e-6, 0.12903155332383157]

    w6t = [0.03334301274581393, 0.043788372353946975, 0.023441286420530106,
           0.02292079374729246, 0.018699208598640677, 0.0645166303463544,
           1.0265273307661839e-8, 0.12485443550071319, 3.200576486338617e-8,
           0.0275755955209456, 0.20548219246059177, 1.2669156569596701e-8,
           1.33343238489931e-8, 0.11301704281799546, 0.004802045362351635,
           0.021831178903670784, 0.04448711360634342, 0.15164590273768536,
           0.0056629210819081986, 0.09393219952069741]

    w7t = [0.007909532269239685, 0.030689732371716544, 0.010506794265829837,
           0.027486773064477565, 0.01227752407536516, 0.03341134826027093,
           2.5150449549825336e-8, 0.13984830025446535, 4.249827078239585e-8,
           9.042694634714465e-7, 0.28782216287128803, 2.7037444945085863e-8,
           2.0887494979613736e-8, 0.12528315698780826, 1.1728710494657163e-7,
           0.015085354653891736, 1.4584393287540855e-6, 0.1931234446153508,
           5.340947835156622e-8, 0.11655322733126024]

    w8t = [0.010670739777381553, 0.027727044657323455, 0.00517567836938981,
           0.014797892800878466, 0.000795759715323882, 0.025358527628136493,
           1.0620785116420576e-8, 0.13425417345536547, 4.2322419783665755e-8,
           5.411405480915734e-7, 0.3078270739275031, 1.5968064387338024e-8,
           8.781791040113087e-9, 0.12812196510078386, 3.47199830199817e-8,
           2.501434229742448e-6, 0.00862960617253487, 0.20753837518545426,
           7.484483043885955e-8, 0.12909993337727335]

    w9t = [0.03334306710375076, 0.04378838840633111, 0.023441319404132344,
           0.022920819320464816, 0.018699269458770873, 0.06451662334838014,
           9.803894035384036e-9, 0.12485447622888086, 3.0374650573979826e-8,
           0.02757557998238627, 0.20548211777573056, 1.206545394047722e-8,
           1.2743988638641454e-8, 0.1130169943364038, 0.004802087069889105,
           0.02183119930926684, 0.0444870960255071, 0.15164580175450557,
           0.005662920189559878, 0.09393217529805296]

    w10t = [0.007911813464310113, 0.03068510213747275, 0.010505366137939913,
            0.02748375285330511, 0.012276170276067139, 0.03340727036207522,
            3.968191684113028e-7, 0.1398469015680947, 6.62690268489184e-7,
            1.412505225860106e-5, 0.2878192785440307, 4.2200065419448415e-7,
            3.296864762413375e-7, 0.12527560333674628, 1.836077875288932e-6,
            0.015083599354027831, 2.2788913817547395e-5, 0.19311714086150886,
            8.333796539106878e-7, 0.11654660648424862]

    w11t = [0.007940343440459626, 0.030634853888863542, 0.010480246994367077,
            0.02746506524587317, 0.012245127022203104, 0.03334485036997602,
            3.500385774543004e-7, 0.13984265831460876, 9.094404090733543e-7,
            5.8228866272140154e-5, 0.2878742372792924, 4.0791092099686144e-7,
            2.783630539619788e-7, 0.1252635607495454, 4.520237197347675e-6,
            0.01506391038570315, 9.576531689175073e-5, 0.19312917261528162,
            1.5073402391213533e-6, 0.11655400618026439]

    w12t = [0.03334306392629812, 0.04378838741607847, 0.023441303652430783,
            0.022920791171853576, 0.018699247761822073, 0.06451664206152088,
            1.0145969311087692e-8, 0.12485446291476845, 3.1749059209110065e-8,
            0.02757557212881489, 0.2054821046260904, 1.2560352170382212e-8,
            1.3168578609547878e-8, 0.11301701924719756, 0.004802061842329558,
            0.021831176806415935, 0.04448711415519218, 0.15164582478565117,
            0.005662971174324261, 0.09393218870525252]

    w13t = [0.007920657427616102, 0.030668637277263787, 0.010500432216142167,
            0.02747291052000619, 0.012271335324959031, 0.03339309453273026,
            1.7288807624662253e-6, 0.1398419645980313, 2.9026467834348955e-6,
            6.137370886041355e-5, 0.2878082866151442, 1.846323615352377e-6,
            1.4383344416742414e-6, 0.12524860212395514, 7.99751837573715e-6,
            0.015077475176263464, 9.879305762316453e-5, 0.19309419174111606,
            3.645964678029406e-6, 0.11652268601163202]

    w14t = [0.007949498491646728, 0.03062225130426573, 0.010477563259287564,
            0.027458768148515687, 0.012239556732576276, 0.03333323672372583,
            4.381747243159045e-7, 0.13984112023857193, 1.132820086288224e-6,
            7.292905485153967e-5, 0.2878806653049824, 5.108095238294895e-7,
            3.497155080628157e-7, 0.1252575543601538, 5.661520843896587e-6,
            0.015060394731894257, 0.00011999425671139572, 0.19312762886413323,
            1.873887110975119e-6, 0.1165488716008864]

    w15t = [0.03334301274581393, 0.043788372353946975, 0.023441286420530106,
            0.02292079374729246, 0.018699208598640677, 0.0645166303463544,
            1.0265273307661839e-8, 0.12485443550071319, 3.200576486338617e-8,
            0.0275755955209456, 0.20548219246059177, 1.2669156569596701e-8,
            1.33343238489931e-8, 0.11301704281799546, 0.004802045362351635,
            0.021831178903670784, 0.04448711360634342, 0.15164590273768536,
            0.0056629210819081986, 0.09393219952069741]

    w16t = [0.007909532269239685, 0.030689732371716544, 0.010506794265829837,
            0.027486773064477565, 0.01227752407536516, 0.03341134826027093,
            2.5150449549825336e-8, 0.13984830025446535, 4.249827078239585e-8,
            9.042694634714465e-7, 0.28782216287128803, 2.7037444945085863e-8,
            2.0887494979613736e-8, 0.12528315698780826, 1.1728710494657163e-7,
            0.015085354653891736, 1.4584393287540855e-6, 0.1931234446153508,
            5.340947835156622e-8, 0.11655322733126024]

    w17t = [0.007912576724178604, 0.030686183328976536, 0.01050386185643397,
            0.027486089125381183, 0.0122740489476589, 0.0334053459291357,
            5.9392218546817735e-9, 0.13984806113152357, 1.5403244625225502e-8,
            9.798477311177915e-7, 0.28782825406017026, 6.926193012751658e-9,
            4.729660218676926e-9, 0.12528456113573408, 7.670374753371615e-8,
            0.015083634686199419, 1.5988069859350957e-6, 0.19312685117079995,
            2.5547136588052608e-8, 0.11655781799988686]

    w18t = [0.03334306710375076, 0.04378838840633111, 0.023441319404132344,
            0.022920819320464816, 0.018699269458770873, 0.06451662334838014,
            9.803894035384036e-9, 0.12485447622888086, 3.0374650573979826e-8,
            0.02757557998238627, 0.20548211777573056, 1.206545394047722e-8,
            1.2743988638641454e-8, 0.1130169943364038, 0.004802087069889105,
            0.02183119930926684, 0.0444870960255071, 0.15164580175450557,
            0.005662920189559878, 0.09393217529805296]

    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t)
    @test isapprox(w3.weights, w3t)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t)
    @test isapprox(w6.weights, w6t)
    @test isapprox(w7.weights, w7t)
    @test isapprox(w8.weights, w8t)
    @test isapprox(w9.weights, w9t)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t)
    @test isapprox(w12.weights, w12t)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t)
    @test isapprox(w15.weights, w15t)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t)
    @test isapprox(w18.weights, w18t)
    @test isapprox(w0.weights, w1.weights)
    @test isapprox(w0.weights, w10.weights)
    @test isapprox(w1.weights, w10.weights)
    @test isapprox(w3.weights, w12.weights)
    @test isapprox(w7.weights, w16.weights)
    @test isapprox(w9.weights, w18.weights)
end

@testset "$(:Classic), $(:WC), $(:Utility)" begin
    portfolio = Portfolio(; prices = prices,
                          solvers = OrderedDict(:Clarabel => Dict(:solver => Clarabel.Optimizer,
                                                                  :params => Dict("verbose" => false,
                                                                                  "max_step_fraction" => 0.75)),
                                                :COSMO => Dict(:solver => COSMO.Optimizer,
                                                               :params => Dict("verbose" => false))))
    asset_statistics!(portfolio)

    opt = OptimiseOpt(; rf = rf, l = l, class = :Classic, type = :Trad, rm = :SD,
                      obj = :Utility, kelly = :None)

    w0 = optimise!(portfolio, opt)

    wc_statistics!(portfolio, WCOpt(; box = :Normal, ellipse = :Normal, seed = 123456789))
    opt.type = :WC

    opt.u_cov = :None
    opt.u_mu = :None
    w1 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w2 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w3 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w4 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w5 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w6 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w7 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w8 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w9 = optimise!(portfolio, opt)
    wc_statistics!(portfolio, WCOpt(; box = :Delta, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w10 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w11 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w12 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w13 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w14 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w15 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w16 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w17 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w18 = optimise!(portfolio, opt)

    w1t = [1.8806825315287365e-9, 3.862038288374664e-9, 5.3002004387495145e-9,
           4.036002575991236e-9, 0.7741908142503021, 3.8445966380599916e-10,
           0.10998661007165159, 1.852701338887806e-9, 5.530542601292167e-9,
           1.7145172711134676e-9, 1.5657439073700846e-9, 4.404614975595981e-10,
           8.278998697027929e-10, 3.393489762947003e-10, 7.56536345977105e-10,
           0.11582251334241239, 1.8378733654274228e-8, 2.095243020357391e-9,
           1.0434852414339229e-8, 2.9356695212202287e-9]

    w2t = [2.805716182855447e-8, 6.08836560674535e-8, 1.0568078121539315e-7,
           6.412319419224896e-8, 0.7874637096101028, 8.774228637136583e-9,
           0.09194225139663352, 2.6192987734625515e-8, 9.665810121922179e-8,
           2.502489043857906e-8, 2.3372371214078192e-8, 8.255036261045137e-9,
           6.2570401010769666e-9, 1.3190093762174292e-8, 6.19853436271278e-9,
           0.12059116015354673, 1.957546955347339e-6, 2.9194381642424098e-8,
           3.771014356961893e-7, 4.232886722575466e-8]

    w3t = [1.6134924930450587e-9, 5.209667643107328e-9, 0.04359449414441498,
           1.39694470046583e-8, 0.43263158834931115, 2.306369571184111e-10,
           0.08625320969578629, 1.0017956901046644e-9, 5.595016964544392e-9,
           9.167620696730358e-10, 8.666903056192473e-10, 2.1753760695909817e-10,
           1.4439961955594965e-10, 4.0071317181094575e-10, 1.453604358900604e-10,
           0.13812577947304813, 0.22999972239958294, 1.111647062275163e-9,
           0.0693951720086272, 2.50606230361642e-9]

    w4t = [5.252194395056978e-9, 1.0315354940168556e-8, 9.455445139288418e-9,
           4.013209229711783e-9, 0.5819241901849773, 6.270890448664268e-10,
           2.0561433724117197e-9, 6.707564335612324e-9, 7.865563734245912e-9,
           4.17450063970948e-9, 1.0991695351988044e-8, 2.190782811533936e-10,
           1.1231785837732019e-10, 2.540524563038986e-9, 1.8113974061846706e-10,
           1.0750087695591245e-8, 0.4180755819596067, 1.2097725746430656e-8,
           1.273857143447765e-7, 1.3110067658773902e-8]

    w5t = [7.450617569435218e-8, 1.691770721106442e-7, 1.5674713909543173e-7,
           5.366042775942177e-8, 0.5520776394586348, 1.841614638968509e-8,
           2.9069631672507916e-8, 9.268404826263314e-8, 1.0485330110287837e-7,
           5.446057054512299e-8, 1.895901900882436e-7, 1.1836606212753126e-8,
           6.95050328547548e-9, 3.6737651102745956e-8, 8.326868461141755e-9,
           1.4663521610097443e-7, 0.4479156448057725, 2.156962163971092e-7,
           5.09262226349376e-6, 2.5376556505840216e-7]

    w6t = [8.530599802758457e-9, 8.229614777650541e-8, 0.0034886131295295527,
           4.440370678103484e-9, 0.3540896788882725, 1.0028379194183124e-9,
           1.7819747052012108e-9, 8.45850623048597e-9, 7.279297754689279e-9,
           3.732335500924744e-9, 4.06508699662571e-8, 5.924992511217655e-10,
           3.1061132913015636e-10, 2.3345858661956912e-9, 3.8649702085869306e-10,
           2.202616430990188e-8, 0.4071218619039125, 5.564435295864237e-8,
           0.1914275241555995, 0.04387208245503499]

    w7t = [0.06154148810193682, 0.07055303049160111, 0.07094003465884087,
           0.04171713541861104, 0.106524690006666, 3.473398251311163e-8,
           0.020758448751352517, 0.05117081953119774, 0.05272467836890281,
           0.03425069187399879, 0.07283158866452577, 3.47029421652274e-8,
           1.4611604084024919e-8, 2.969841230044783e-6, 1.6275824321409947e-8,
           0.04635834382067999, 0.1219952421974018, 0.074795262801851, 0.08947880598030208,
           0.08435666916654858]

    w8t = [0.06127935336982063, 0.07016304634244055, 0.07008299018780012,
           0.040443247356608446, 0.10490990595676578, 8.83409321788589e-10,
           0.019330949723235683, 0.05203128315484953, 0.05179542724440867,
           0.03395010783658188, 0.07643582386269095, 8.585079414880482e-10,
           3.139048035593693e-10, 0.0007819538971268028, 3.5071382668103423e-10,
           0.04481522126528696, 0.12218769439234191, 0.07719347443681834,
           0.08946889216165199, 0.08513062640503581]

    w9t = [0.06189187980373432, 0.07006927810096528, 0.06966034183353734,
           0.04125605395429304, 0.10114622103764992, 1.4242301611322097e-9,
           0.01990924512311654, 0.053178460880854546, 0.05246497635297446,
           0.03573180797758352, 0.07635554216749009, 1.3917014828373305e-9,
           5.518614252569841e-10, 0.005283227177752205, 6.085977433875741e-10,
           0.044928450453897976, 0.11867674226386117, 0.07707352963848324,
           0.08800456338649758, 0.08436967587091804]

    w10t = [1.8806825315287365e-9, 3.862038288374664e-9, 5.3002004387495145e-9,
            4.036002575991236e-9, 0.7741908142503021, 3.8445966380599916e-10,
            0.10998661007165159, 1.852701338887806e-9, 5.530542601292167e-9,
            1.7145172711134676e-9, 1.5657439073700846e-9, 4.404614975595981e-10,
            8.278998697027929e-10, 3.393489762947003e-10, 7.56536345977105e-10,
            0.11582251334241239, 1.8378733654274228e-8, 2.095243020357391e-9,
            1.0434852414339229e-8, 2.9356695212202287e-9]

    w11t = [9.404652325727814e-9, 1.719868515706557e-8, 2.8483182803795e-8,
            1.853177179679032e-8, 0.7565390342554569, 3.9972899878833765e-9,
            0.1059280993027199, 8.974718284349187e-9, 2.6157918994097238e-8,
            8.638697017100152e-9, 8.226099866073654e-9, 3.841004767255786e-9,
            3.0219011228410342e-9, 5.4547626890407746e-9, 3.0225617033537158e-9,
            0.13753218743600373, 4.178744252926253e-7, 9.656312612804123e-9,
            9.37669381383348e-8, 1.2754897051566412e-8]

    w12t = [1.6134924930450587e-9, 5.209667643107328e-9, 0.04359449414441498,
            1.39694470046583e-8, 0.43263158834931115, 2.306369571184111e-10,
            0.08625320969578629, 1.0017956901046644e-9, 5.595016964544392e-9,
            9.167620696730358e-10, 8.666903056192473e-10, 2.1753760695909817e-10,
            1.4439961955594965e-10, 4.0071317181094575e-10, 1.453604358900604e-10,
            0.13812577947304813, 0.22999972239958294, 1.111647062275163e-9,
            0.0693951720086272, 2.50606230361642e-9]

    w13t = [3.647902119428961e-10, 2.1977715335790454e-9, 4.064170032796999e-9,
            2.3972232748394194e-9, 0.75478163814755, 1.0679235246725186e-9,
            0.10551594374842024, 3.776810262001307e-10, 4.357820292261647e-9,
            2.573044832077191e-10, 2.0018803785122081e-10, 1.0995315175089325e-9,
            1.220582723514187e-9, 6.127953723783301e-10, 1.2973729020478185e-9,
            0.13970233618556752, 4.547259952804259e-8, 5.552311979866896e-10,
            1.5145933671581878e-8, 1.229542917036613e-9]

    w14t = [2.5072209766309822e-8, 6.524666595724082e-8, 1.1896052969985183e-7,
            6.909663326699326e-8, 0.7308742850376809, 7.212472757491972e-9,
            0.10068813093051053, 2.254831575050526e-8, 1.132357089583602e-7,
            2.1019738015053924e-8, 1.9730851398734935e-8, 6.8360481915692516e-9,
            5.105795130626096e-9, 1.0818491016554973e-8, 5.1298284977106645e-9,
            0.15517673273094307, 0.013259494231541139, 2.554183563971588e-8,
            8.004181652842922e-7, 4.109603501203217e-8]

    w15t = [3.346182369310799e-9, 1.8814498734948924e-8, 0.05739276887818723,
            1.2471178782543721e-7, 0.4004858074285381, 2.860530356506467e-10,
            0.07865418844024352, 1.673062868309231e-9, 1.4270428339153007e-8,
            1.449401537559231e-9, 1.3635241135884544e-9, 2.696198135120669e-10,
            1.7594372147856998e-10, 5.203074010445681e-10, 1.788202149277225e-10,
            0.13380938791810462, 0.23671574575195187, 1.9298095180954252e-9,
            0.09294192576995902, 6.823575999424824e-9]

    w16t = [0.06154148810193682, 0.07055303049160111, 0.07094003465884087,
            0.04171713541861104, 0.106524690006666, 3.473398251311163e-8,
            0.020758448751352517, 0.05117081953119774, 0.05272467836890281,
            0.03425069187399879, 0.07283158866452577, 3.47029421652274e-8,
            1.4611604084024919e-8, 2.969841230044783e-6, 1.6275824321409947e-8,
            0.04635834382067999, 0.1219952421974018, 0.074795262801851, 0.08947880598030208,
            0.08435666916654858]

    w17t = [0.06092543692852642, 0.07012444194654223, 0.07015926007885717,
            0.041291494165379465, 0.10537817532454621, 6.209791958715301e-10,
            0.020415426894565877, 0.052724278669763674, 0.0518872470559541,
            0.03425371141533547, 0.07562781937975124, 6.290795241845486e-10,
            2.542207647432861e-10, 0.0004510369756398726, 2.825965993028993e-10,
            0.04610247519996351, 0.12113150363551169, 0.07628554829052657,
            0.08875896584469854, 0.08448317640756176]

    w18t = [0.06189187980373432, 0.07006927810096528, 0.06966034183353734,
            0.04125605395429304, 0.10114622103764992, 1.4242301611322097e-9,
            0.01990924512311654, 0.053178460880854546, 0.05246497635297446,
            0.03573180797758352, 0.07635554216749009, 1.3917014828373305e-9,
            5.518614252569841e-10, 0.005283227177752205, 6.085977433875741e-10,
            0.044928450453897976, 0.11867674226386117, 0.07707352963848324,
            0.08800456338649758, 0.08436967587091804]

    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t)
    @test isapprox(w3.weights, w3t)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t)
    @test isapprox(w6.weights, w6t)
    @test isapprox(w7.weights, w7t)
    @test isapprox(w8.weights, w8t)
    @test isapprox(w9.weights, w9t, rtol = 1.0e-5)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t)
    @test isapprox(w12.weights, w12t)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t)
    @test isapprox(w15.weights, w15t)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t)
    @test isapprox(w18.weights, w18t, rtol = 1.0e-5)
    @test isapprox(w0.weights, w1.weights)
    @test isapprox(w0.weights, w10.weights)
    @test isapprox(w1.weights, w10.weights)
    @test isapprox(w3.weights, w12.weights)
    @test isapprox(w7.weights, w16.weights)
    @test isapprox(w9.weights, w18.weights)
end

@testset "$(:Classic), $(:WC), $(:Sharpe)" begin
    portfolio = Portfolio(; prices = prices,
                          solvers = OrderedDict(:Clarabel => Dict(:solver => Clarabel.Optimizer,
                                                                  :params => Dict("verbose" => false,
                                                                                  "max_step_fraction" => 0.75)),
                                                :COSMO => Dict(:solver => COSMO.Optimizer,
                                                               :params => Dict("verbose" => false))))
    asset_statistics!(portfolio)

    opt = OptimiseOpt(; rf = rf, l = l, class = :Classic, type = :Trad, rm = :SD,
                      obj = :Sharpe, kelly = :None)

    w0 = optimise!(portfolio, opt)

    opt.type = :WC
    wc_statistics!(portfolio, WCOpt(; box = :Normal, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w1 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w2 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w3 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w4 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w5 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w6 = optimise!(portfolio, opt)
    wc_statistics!(portfolio, WCOpt(; box = :Delta, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w10 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w11 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w12 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w13 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w14 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w15 = optimise!(portfolio, opt)
    opt.kelly = :Approx
    opt.u_cov = :None
    opt.u_mu = :None
    w16 = optimise!(portfolio, opt)
    opt.kelly = :Exact
    w17 = optimise!(portfolio, opt)

    w1t = [1.0582219191763675e-9, 3.033341281368263e-9, 4.093973467616387e-9,
           2.4302432491378547e-9, 0.518058049464457, 3.284428917099043e-10,
           0.06365095369119145, 2.483269319093602e-9, 2.345993206888518e-9,
           1.1710759933582023e-9, 1.9667796025518083e-9, 2.6638354190663204e-10,
           1.933888387868567e-10, 5.926494610003628e-10, 1.8755971351419546e-10,
           0.143267787756283, 0.19649630246514146, 2.335142195851285e-9,
           0.07852688169059606, 2.4458664972621787e-9]

    w2t = [2.8412816525478146e-8, 0.00035196294061108315, 1.3052329509733161e-6,
           2.87254720878552e-7, 0.2666085608412865, 3.066695991497784e-9,
           0.011445317506056641, 0.06657588647768221, 4.956539340550331e-8,
           4.942883684369277e-8, 0.1613717386465365, 1.9418616900887073e-9,
           1.3645330112497187e-9, 1.1146847727603151e-8, 1.4308219462717556e-9,
           0.07263796658744098, 0.2016984496157288, 0.10136663350490349,
           0.08771684891228358, 0.030224896121991304]

    w3t = [0.0013829889796883787, 0.05289465810034897, 0.05680963805760192,
           0.029884905668557265, 0.14968544715920773, 1.2131925842482369e-8,
           0.02317046752539589, 0.07708670439583501, 0.001591151756161292,
           3.851723274459506e-7, 0.12835046576498207, 8.098597714517138e-9,
           5.217638194447905e-9, 4.5061612784572055e-8, 5.979733075205657e-9,
           0.06552558260627016, 0.1409458343734348, 0.09810202499873028,
           0.09252322065140348, 0.0820464483005476]

    w4t = [6.466684324776656e-11, 8.516807283687845e-11, 9.472315022300327e-11,
           5.1957167657756756e-11, 0.9999999985074259, 2.0192854664051626e-11,
           3.436252425053897e-11, 5.149260592067322e-11, 7.462642590762538e-11,
           4.561655322527492e-11, 6.186767722266438e-11, 1.3899284282467578e-11,
           7.750637790067232e-12, 3.337064177968372e-11, 9.659444439315246e-12,
           7.302466718285475e-11, 4.5866872942896926e-10, 7.012474376020365e-11,
           1.5414496160965011e-10, 8.72570588192862e-11]

    w5t = [1.9409089548743477e-10, 3.1564619696752674e-10, 3.25738141555929e-10,
           1.5005563626271312e-10, 0.7008304542355122, 5.069791714974362e-11,
           8.841751111869289e-11, 1.8416820618235487e-10, 2.578481887264228e-10,
           1.4192124066866055e-10, 2.5722874917391247e-10, 3.295120542776688e-11,
           1.8052557212010085e-11, 9.760762013674915e-11, 2.1941995624520676e-11,
           2.8101096518769044e-10, 0.29916954115599875, 2.9589738294333433e-10,
           1.536051217227758e-9, 3.591635066988638e-10]

    w6t = [2.506095649549513e-9, 4.073932462549125e-9, 5.398203824382228e-9,
           1.7124152016083e-9, 0.5595813927700654, 5.041149809015869e-10,
           9.301581926261557e-10, 1.7772324676327418e-9, 2.925154318124677e-9,
           1.4345380281140104e-9, 2.4613263738856962e-9, 3.356445049268043e-10,
           1.8302054465026085e-10, 9.607030827561177e-10, 2.2269986409270587e-10,
           2.973016099880799e-9, 0.440418533386535, 2.9159143281310575e-9,
           3.789912264383553e-8, 4.630106930193754e-9]

    w10t = [1.0582219191763675e-9, 3.033341281368263e-9, 4.093973467616387e-9,
            2.4302432491378547e-9, 0.518058049464457, 3.284428917099043e-10,
            0.06365095369119145, 2.483269319093602e-9, 2.345993206888518e-9,
            1.1710759933582023e-9, 1.9667796025518083e-9, 2.6638354190663204e-10,
            1.933888387868567e-10, 5.926494610003628e-10, 1.8755971351419546e-10,
            0.143267787756283, 0.19649630246514146, 2.335142195851285e-9,
            0.07852688169059606, 2.4458664972621787e-9]

    w11t = [1.2956131060418805e-8, 0.007766319902530555, 0.0038698884729426297,
            0.0027575452131157895, 0.25099632102291025, 1.858344145755973e-9,
            0.02315866528942557, 0.08562254546821742, 2.5174951275929287e-8,
            2.232352055014575e-8, 0.16236982155031543, 1.202395823623793e-9,
            8.423879654324937e-10, 5.821294294758675e-9, 9.014353926181081e-10,
            0.08334324969810843, 0.1653508499370702, 0.10483367172634506,
            0.07552186008510518, 0.03440919055345298]

    w12t = [0.0013829889796883787, 0.05289465810034897, 0.05680963805760192,
            0.029884905668557265, 0.14968544715920773, 1.2131925842482369e-8,
            0.02317046752539589, 0.07708670439583501, 0.001591151756161292,
            3.851723274459506e-7, 0.12835046576498207, 8.098597714517138e-9,
            5.217638194447905e-9, 4.5061612784572055e-8, 5.979733075205657e-9,
            0.06552558260627016, 0.1409458343734348, 0.09810202499873028,
            0.09252322065140348, 0.0820464483005476]

    w13t = [7.86104680168596e-11, 2.581689370363608e-10, 3.751927152447362e-10,
            2.1247028587508447e-10, 0.523634883488626, 1.9486433116903062e-11,
            0.06464274713780861, 1.549689208956321e-10, 2.0554803821712053e-10,
            7.975947674723269e-11, 1.2077742964126379e-10, 1.6434493809377638e-11,
            1.1964486515368817e-11, 3.6573008241479916e-11, 1.0468424536562565e-11,
            0.14384439793458836, 0.19321690478313466, 1.5557988191105592e-10,
            0.07466106472997303, 1.898664279910272e-10]

    w14t = [1.2263904439118016e-8, 0.007060252113352363, 0.0036540730976423025,
            0.0021522184115763767, 0.2551009198991718, 1.1756276183234802e-9,
            0.023705335955290292, 0.08460251834282648, 2.3885920274456877e-8,
            2.0788888043866e-8, 0.15915641603733602, 7.943942762030404e-10,
            5.310613607982868e-10, 3.797525765151979e-9, 5.674070944570201e-10,
            0.08446004253353889, 0.16761618932791755, 0.10250681464525724,
            0.07714491088562073, 0.03284024494574102]

    w15t = [0.0006349951200802388, 0.05287442943129372, 0.05737761768428593,
            0.029900467172599105, 0.15195940610239203, 5.121137250150451e-9,
            0.023649186353591395, 0.07586185033251894, 0.0014591370672878644,
            2.3518767266877542e-7, 0.12587967955458468, 3.6021540565150086e-9,
            2.3029962122604884e-9, 1.8180230308581496e-8, 2.605872815371713e-9,
            0.06631231635640804, 0.1425361650125045, 0.09642410440423084,
            0.09353297965117609, 0.08159739875698352]

    w16t = [1.8936023733971716e-7, 7.759755252629935e-7, 1.030806203991613e-6,
            4.859440578422584e-7, 0.45249930505411073, 5.660324801246874e-8,
            0.05199219525670206, 2.6247324027201767e-6, 3.080955476028156e-7,
            2.2165249031163672e-7, 9.981959921562277e-7, 4.3163677394287155e-8,
            3.194465829791772e-8, 1.0930201332601899e-7, 3.1218211513058067e-8,
            0.13648884753629192, 0.2350440113219722, 9.922895023025335e-7,
            0.1239670381377456, 7.034094093603752e-7]

    w17t = [2.0184456345048768e-8, 6.618692139937966e-8, 8.648692815426136e-8,
            4.760981393989345e-8, 0.48941508879975115, 6.2929759532963e-9,
            0.05833663800209291, 6.853354731936131e-8, 4.458883181890003e-8,
            2.298252674522769e-8, 4.96139104169387e-8, 5.101272720052931e-9,
            3.722385516976071e-9, 1.1484275309689927e-8, 3.614760596055875e-9,
            0.140325949013441, 0.21337780603089268, 5.831498491601652e-8,
            0.09854396946956434, 5.3966666897345284e-8]
    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t, rtol = 1.0e-6)
    @test isapprox(w3.weights, w3t, rtol = 1e-7)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t, rtol = 1.0e-6)
    @test isapprox(w6.weights, w6t, rtol = 1.0e-6)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t, rtol = 1.0e-6)
    @test isapprox(w12.weights, w12t, rtol = 1e-7)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t, rtol = 1.0e-5)
    @test isapprox(w15.weights, w15t, rtol = 1.0e-6)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t, rtol = 1.0e-5)
    @test isapprox(w0.weights, w1.weights, rtol = 1.0e-7)
    @test isapprox(w0.weights, w10.weights, rtol = 1.0e-7)
    @test isapprox(w1.weights, w10.weights)
    @test isapprox(w3.weights, w12.weights)
end

@testset "$(:Classic), $(:WC), $(:Max_Ret)" begin
    portfolio = Portfolio(; prices = prices,
                          solvers = OrderedDict(:Clarabel => Dict(:solver => Clarabel.Optimizer,
                                                                  :params => Dict("verbose" => false,
                                                                                  "max_step_fraction" => 0.75)),
                                                :COSMO => Dict(:solver => COSMO.Optimizer,
                                                               :params => Dict("verbose" => false))))
    asset_statistics!(portfolio)

    opt = OptimiseOpt(; rf = rf, l = l, class = :Classic, type = :Trad, rm = :SD,
                      obj = :Max_Ret, kelly = :None)

    w0 = optimise!(portfolio, opt)

    wc_statistics!(portfolio, WCOpt(; box = :Normal, ellipse = :Normal, seed = 123456789))
    opt.type = :WC

    opt.u_cov = :None
    opt.u_mu = :None
    w1 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w2 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w3 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w4 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w5 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w6 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w7 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w8 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w9 = optimise!(portfolio, opt)
    wc_statistics!(portfolio, WCOpt(; box = :Delta, ellipse = :Normal, seed = 123456789))
    opt.u_cov = :None
    opt.u_mu = :None
    w10 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :None
    w11 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :None
    w12 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Box
    w13 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Box
    w14 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Box
    w15 = optimise!(portfolio, opt)
    opt.u_cov = :None
    opt.u_mu = :Ellipse
    w16 = optimise!(portfolio, opt)
    opt.u_cov = :Box
    opt.u_mu = :Ellipse
    w17 = optimise!(portfolio, opt)
    opt.u_cov = :Ellipse
    opt.u_mu = :Ellipse
    w18 = optimise!(portfolio, opt)

    w1t = [2.242587206880573e-8, 2.3869345719665024e-8, 3.0249972077364615e-8,
           2.7441036414624337e-8, 2.674016473443787e-6, 1.111794542964317e-8,
           0.999996954927899, 1.6603745204232977e-8, 2.5223224543701134e-8,
           1.8088400369515617e-8, 1.6172380723211374e-8, 1.16166386268502e-8,
           8.681387038232673e-9, 1.3771962838160079e-8, 8.992921449936008e-9,
           4.039243448317557e-8, 3.1600448893350835e-8, 1.7426103715815354e-8,
           2.6166436902355393e-8, 2.121537093958793e-8]

    w2t = [6.989037895383436e-8, 7.480538211882142e-8, 9.691293470711082e-8,
           8.678037210737846e-8, 8.837803088408388e-6, 3.40581564078145e-8,
           0.999989993339588, 5.0910247631747685e-8, 7.956894828568414e-8,
           5.5670422521762763e-8, 4.9439177610106315e-8, 3.572433741796514e-8,
           2.7230914956887026e-8, 4.200273372251963e-8, 2.7981881709706302e-8,
           1.336944045080762e-7, 1.019575350256201e-7, 5.343621688355654e-8,
           8.291247355406826e-8, 6.588080521189712e-8]

    w3t = [1.4060921805235678e-10, 1.4949077233619802e-10, 1.891469810220563e-10,
           1.7136936559291537e-10, 1.7263712877360994e-8, 7.150739340310614e-11,
           0.9999999803939431, 1.053761521517774e-10, 1.581562203951017e-10,
           1.1445175043694404e-10, 1.0252882112526467e-10, 7.50736768261991e-11,
           5.6767564333026305e-11, 8.789211612315543e-11, 5.849663309620243e-11,
           2.5610705259602627e-10, 1.97927331871931e-10, 1.1017186447340506e-10,
           1.6400086192517422e-10, 1.3326996747308843e-10]

    w4t = [4.2042049734727806e-8, 4.521518897189257e-8, 5.659006070667893e-8,
           3.514877814292186e-8, 0.9999993010578468, 1.5765085402586468e-8,
           2.7221728971256205e-8, 2.833331125793981e-8, 4.0442398566396016e-8,
           2.820564078004165e-8, 3.015401882144552e-8, 1.3622176589629896e-8,
           8.610124539098548e-9, 2.1881580106619616e-8, 1.0054344351204034e-8,
           3.857715060414015e-8, 1.2018663273637416e-7, 3.337382833665426e-8,
           5.928283670571385e-8, 4.42352177893344e-8]

    w5t = [9.377415466609279e-8, 1.0272420517112992e-7, 1.2379069963449228e-7,
           7.88908877064689e-8, 0.9999984542188851, 3.381052043433265e-8,
           6.063461327909876e-8, 6.528284321580322e-8, 9.272801754761999e-8,
           6.438645876637771e-8, 7.101071935434272e-8, 2.8462432632992756e-8,
           1.7554303492159786e-8, 4.916101198170805e-8, 2.050205062361616e-8,
           8.907634792253174e-8, 2.403215484938327e-7, 7.852171953659121e-8,
           1.338002068689107e-7, 1.0134837351440007e-7]

    w6t = [5.625466722347094e-11, 6.205759795810088e-11, 7.574727528721409e-11,
           4.673261003628035e-11, 0.9999999990746032, 1.9236659513414705e-11,
           3.540535381787307e-11, 3.8122510959053476e-11, 5.5572089269728423e-11,
           3.756758642544284e-11, 4.175945668369203e-11, 1.631064138152141e-11,
           9.991904223580483e-12, 2.8251914269238797e-11, 1.1690030274220593e-11,
           5.333084368188005e-11, 1.4743061474199397e-10, 4.651918866482874e-11,
           8.220798782881751e-11, 6.120777507566042e-11]

    w7t = [0.06890844046144488, 0.07563301277540496, 0.08064180211050946,
           0.04718407812860236, 0.12123502290772788, 7.0313224803652085e-9,
           0.02506892317635273, 0.03072415112000338, 0.06253783187722084,
           0.03349353671003257, 0.03704527471874409, 9.024440907298205e-9,
           3.392187193830196e-9, 3.5586483043216114e-8, 3.6559770971977593e-9,
           0.04942196685863766, 0.13244524162705806, 0.05548138936532516,
           0.0977197318858018, 0.08245953758672354]

    w8t = [0.06890840444100681, 0.07563296700087997, 0.08064175237302901,
           0.047184070427970175, 0.1212349374788409, 2.8975417463047654e-8,
           0.025068926687489616, 0.03072427574438468, 0.06253780533916545,
           0.033493594503237245, 0.037045411879595536, 3.7126647764728154e-8,
           1.4048418138863368e-8, 1.473585842432503e-7, 1.503771375237347e-8,
           0.04942195193001917, 0.1324451313110057, 0.05548139045484467,
           0.09771965938255386, 0.08245947849919592]

    w9t = [0.06890845604928575, 0.07563303279682644, 0.08064182506490564,
           0.04718407970609786, 0.12123506094192892, 2.6560750339254884e-10,
           0.025068921402331926, 0.03072408855193541, 0.06253784399850387,
           0.03349350676261824, 0.037045205827225335, 3.482014707554757e-10,
           1.3335448412447865e-10, 1.3466832342059471e-9, 1.408441000261654e-10,
           0.049421971517258134, 0.132445294450835, 0.0554813808671151, 0.09771976664906036,
           0.08245956317938141]

    w10t = [2.242587206880573e-8, 2.3869345719665024e-8, 3.0249972077364615e-8,
            2.7441036414624337e-8, 2.674016473443787e-6, 1.111794542964317e-8,
            0.999996954927899, 1.6603745204232977e-8, 2.5223224543701134e-8,
            1.8088400369515617e-8, 1.6172380723211374e-8, 1.16166386268502e-8,
            8.681387038232673e-9, 1.3771962838160079e-8, 8.992921449936008e-9,
            4.039243448317557e-8, 3.1600448893350835e-8, 1.7426103715815354e-8,
            2.6166436902355393e-8, 2.121537093958793e-8]

    w11t = [6.989037895383436e-8, 7.480538211882142e-8, 9.691293470711082e-8,
            8.678037210737846e-8, 8.837803088408388e-6, 3.40581564078145e-8,
            0.999989993339588, 5.0910247631747685e-8, 7.956894828568414e-8,
            5.5670422521762763e-8, 4.9439177610106315e-8, 3.572433741796514e-8,
            2.7230914956887026e-8, 4.200273372251963e-8, 2.7981881709706302e-8,
            1.336944045080762e-7, 1.019575350256201e-7, 5.343621688355654e-8,
            8.291247355406826e-8, 6.588080521189712e-8]

    w12t = [1.4060921805235678e-10, 1.4949077233619802e-10, 1.891469810220563e-10,
            1.7136936559291537e-10, 1.7263712877360994e-8, 7.150739340310614e-11,
            0.9999999803939431, 1.053761521517774e-10, 1.581562203951017e-10,
            1.1445175043694404e-10, 1.0252882112526467e-10, 7.50736768261991e-11,
            5.6767564333026305e-11, 8.789211612315543e-11, 5.849663309620243e-11,
            2.5610705259602627e-10, 1.97927331871931e-10, 1.1017186447340506e-10,
            1.6400086192517422e-10, 1.3326996747308843e-10]

    w13t = [2.2157629001814043e-8, 2.3705206178889556e-8, 3.1337524512027466e-8,
            2.7822239462468775e-8, 3.817602380688397e-6, 1.0845455226582203e-8,
            0.9999958072350622, 1.6162961145208927e-8, 2.5262648251923497e-8,
            1.7620900422092873e-8, 1.572567737326121e-8, 1.129544407446688e-8,
            8.418152681037229e-9, 1.3392424290139792e-8, 8.742579157457356e-9,
            4.5537115159563596e-8, 3.30644482886816e-8, 1.6950167741040277e-8,
            2.6312815513451374e-8, 2.0809168671644914e-8]

    w14t = [6.18672522752248e-8, 6.660463315847458e-8, 9.006687455402096e-8,
            7.887070495555246e-8, 1.089918703360366e-5, 3.042154927163067e-8,
            0.999988034157972, 4.4828590574552585e-8, 7.135787933478868e-8,
            4.8960556991011206e-8, 4.3562684666504686e-8, 3.1867139337999185e-8,
            2.4373219474750287e-8, 3.7212092126252046e-8, 2.5047494973655907e-8,
            1.3578505229067643e-7, 9.590392555704405e-8, 4.701335158291311e-8,
            7.47932751792461e-8, 5.811871818279355e-8]

    w15t = [3.3281309601857706e-11, 3.577844852956738e-11, 4.772107184708236e-11,
            4.2187306000439357e-11, 5.180733138704124e-9, 1.6193242121087643e-11,
            0.9999999942520769, 2.420638218957642e-11, 3.827606425119956e-11,
            2.6418679537901197e-11, 2.3525637242210277e-11, 1.7025096922249347e-11,
            1.2637304827598294e-11, 2.0064157336385215e-11, 1.305101622447521e-11,
            6.960620014774633e-11, 5.053589271818753e-11, 2.5373021644713495e-11,
            4.002318033696007e-11, 3.1285959467081785e-11]

    w16t = [0.06890844046144488, 0.07563301277540496, 0.08064180211050946,
            0.04718407812860236, 0.12123502290772788, 7.0313224803652085e-9,
            0.02506892317635273, 0.03072415112000338, 0.06253783187722084,
            0.03349353671003257, 0.03704527471874409, 9.024440907298205e-9,
            3.392187193830196e-9, 3.5586483043216114e-8, 3.6559770971977593e-9,
            0.04942196685863766, 0.13244524162705806, 0.05548138936532516,
            0.0977197318858018, 0.08245953758672354]

    w17t = [0.06890840444100681, 0.07563296700087997, 0.08064175237302901,
            0.047184070427970175, 0.1212349374788409, 2.8975417463047654e-8,
            0.025068926687489616, 0.03072427574438468, 0.06253780533916545,
            0.033493594503237245, 0.037045411879595536, 3.7126647764728154e-8,
            1.4048418138863368e-8, 1.473585842432503e-7, 1.503771375237347e-8,
            0.04942195193001917, 0.1324451313110057, 0.05548139045484467,
            0.09771965938255386, 0.08245947849919592]

    w18t = [0.06890845604928575, 0.07563303279682644, 0.08064182506490564,
            0.04718407970609786, 0.12123506094192892, 2.6560750339254884e-10,
            0.025068921402331926, 0.03072408855193541, 0.06253784399850387,
            0.03349350676261824, 0.037045205827225335, 3.482014707554757e-10,
            1.3335448412447865e-10, 1.3466832342059471e-9, 1.408441000261654e-10,
            0.049421971517258134, 0.132445294450835, 0.0554813808671151,
            0.09771976664906036, 0.08245956317938141]

    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t)
    @test isapprox(w3.weights, w3t)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t)
    @test isapprox(w6.weights, w6t)
    @test isapprox(w7.weights, w7t)
    @test isapprox(w8.weights, w8t)
    @test isapprox(w9.weights, w9t)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t)
    @test isapprox(w12.weights, w12t)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t)
    @test isapprox(w15.weights, w15t)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t)
    @test isapprox(w18.weights, w18t)
    @test isapprox(w0.weights, w1.weights)
    @test isapprox(w0.weights, w10.weights)
    @test isapprox(w1.weights, w10.weights)
    @test isapprox(w3.weights, w12.weights)
    @test isapprox(w7.weights, w16.weights)
    @test isapprox(w9.weights, w18.weights)
end
