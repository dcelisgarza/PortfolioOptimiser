using COSMO,
    CSV,
    Clarabel,
    HiGHS,
    LinearAlgebra,
    OrderedCollections,
    PortfolioOptimiser,
    Statistics,
    Test,
    TimeSeries,
    SCS

prices = TimeArray(CSV.File("./assets/stock_prices.csv"); timestamp = :date)

rf = 1.0329^(1 / 252) - 1
l = 2.0

@testset "$(:Classic), $(:WC), $(:Min_Risk)" begin
    portfolio = Portfolio(
        prices = prices,
        solvers = OrderedDict(
            :Clarabel => Dict(
                :solver => Clarabel.Optimizer,
                :params => Dict("verbose" => false, "max_step_fraction" => 0.75),
            ),
            :COSMO =>
                Dict(:solver => COSMO.Optimizer, :params => Dict("verbose" => false)),
        ),
    )
    asset_statistics!(portfolio)
    w0 = opt_port!(
        portfolio;
        class = :Classic,
        type = :Trad,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        rm = :SD,
    )

    wc_statistics!(portfolio, box = :Normal, ellipse = :Normal, seed = 123456789)
    w1 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :None,
    )
    w2 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :None,
    )
    w3 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :None,
    )
    w4 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :Box,
    )
    w5 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :Box,
    )
    w6 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :Box,
    )
    w7 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :Ellipse,
    )
    w8 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :Ellipse,
    )
    w9 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :Ellipse,
    )
    wc_statistics!(portfolio, box = :Delta, ellipse = :Normal, seed = 123456789)
    w10 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :None,
    )
    w11 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :None,
    )
    w12 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :None,
    )
    w13 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :Box,
    )
    w14 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :Box,
    )
    w15 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :Box,
    )
    w16 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :Ellipse,
    )
    w17 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :Ellipse,
    )
    w18 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Min_Risk,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :Ellipse,
    )

    w1t = [
        0.007911813464310113,
        0.03068510213747275,
        0.010505366137939913,
        0.02748375285330511,
        0.012276170276067139,
        0.03340727036207522,
        3.968191684113028e-7,
        0.1398469015680947,
        6.62690268489184e-7,
        1.412505225860106e-5,
        0.2878192785440307,
        4.2200065419448415e-7,
        3.296864762413375e-7,
        0.12527560333674628,
        1.836077875288932e-6,
        0.015083599354027831,
        2.2788913817547395e-5,
        0.19311714086150886,
        8.333796539106878e-7,
        0.11654660648424862,
    ]

    w2t = [
        0.011122575949276462,
        0.028812809066713605,
        0.004512486086840133,
        0.015127131583744052,
        0.0002729483834218205,
        0.025504047346488708,
        3.8977037985464304e-7,
        0.13492232492060635,
        1.4458190345794646e-6,
        1.762084916807957e-5,
        0.306182081620025,
        5.699448189678806e-7,
        3.1246618809769173e-7,
        0.12966537758051902,
        1.2297521258686932e-6,
        0.00011286898633560103,
        0.0080651442562935,
        0.20700315760878052,
        2.556211751256578e-6,
        0.12867292179748857,
    ]

    w3t = [
        0.03333132747369123,
        0.04377810669687917,
        0.023427973082167475,
        0.022909798021813328,
        0.018688369967461656,
        0.06451207225655833,
        7.844230625498396e-6,
        0.12486014474751483,
        2.4862736037898968e-5,
        0.027564656122779495,
        0.20549775936633694,
        9.756425508052093e-6,
        1.0147812841754239e-5,
        0.11302433562762651,
        0.00479652846069651,
        0.021822676636146853,
        0.044478776465909094,
        0.15165417399121,
        0.005671718381918033,
        0.09392897149627737,
    ]

    w4t = [
        0.007920657427616102,
        0.030668637277263787,
        0.010500432216142167,
        0.02747291052000619,
        0.012271335324959031,
        0.03339309453273026,
        1.7288807624662253e-6,
        0.1398419645980313,
        2.9026467834348955e-6,
        6.137370886041355e-5,
        0.2878082866151442,
        1.846323615352377e-6,
        1.4383344416742414e-6,
        0.12524860212395514,
        7.99751837573715e-6,
        0.015077475176263464,
        9.879305762316453e-5,
        0.19309419174111606,
        3.645964678029406e-6,
        0.11652268601163202,
    ]

    w5t = [
        0.011100928247540337,
        0.028797601204028744,
        0.00451697386063243,
        0.015117169787606181,
        0.0003076466235640585,
        0.02549899349018155,
        4.5392069132527076e-7,
        0.13491962123190607,
        1.681770276409214e-6,
        2.0441542555369992e-5,
        0.3061835873256772,
        6.640161273806851e-7,
        3.6474620983326474e-7,
        0.12966556794012535,
        1.4319449667839788e-6,
        0.00012979857147209442,
        0.008064036470981209,
        0.20700779271517056,
        2.9705961760174295e-6,
        0.1286622739941112,
    ]

    w6t = [
        0.03333068397098794,
        0.04377757634667947,
        0.023427280647738524,
        0.022909139061975062,
        0.018687717089428593,
        0.06451179945808709,
        7.872726015530742e-6,
        0.12486048096043566,
        2.491670016457108e-5,
        0.027564009124648573,
        0.20549903841837924,
        9.775748954866916e-6,
        1.0189359464332593e-5,
        0.11302512599651851,
        0.004796269727344396,
        0.021822090713067257,
        0.044478258799500084,
        0.15165528349872529,
        0.005673047159692591,
        0.0939294444921923,
    ]

    w7t = [
        0.007909532269239685,
        0.030689732371716544,
        0.010506794265829837,
        0.027486773064477565,
        0.01227752407536516,
        0.03341134826027093,
        2.5150449549825336e-8,
        0.13984830025446535,
        4.249827078239585e-8,
        9.042694634714465e-7,
        0.28782216287128803,
        2.7037444945085863e-8,
        2.0887494979613736e-8,
        0.12528315698780826,
        1.1728710494657163e-7,
        0.015085354653891736,
        1.4584393287540855e-6,
        0.1931234446153508,
        5.340947835156622e-8,
        0.11655322733126024,
    ]

    w8t = [
        0.011292681584580688,
        0.028888110162898103,
        0.004523834576062314,
        0.015184766940010641,
        7.421480374862966e-6,
        0.025530059118293143,
        8.858484101055735e-9,
        0.13493486286840187,
        3.3034331883490654e-8,
        4.0541979888671485e-7,
        0.3061660040058323,
        1.2973279761383562e-8,
        7.0871776941127906e-9,
        0.12965873137917422,
        2.7929867271679124e-8,
        2.815426020909421e-6,
        0.008120030362434012,
        0.20695609705572884,
        5.8378644457650944e-8,
        0.12873403135860406,
    ]

    w9t = [
        0.03333803093029847,
        0.04378509678513202,
        0.02343570240310936,
        0.022916678252223092,
        0.01869405873554269,
        0.06451728594605739,
        2.2538082662688216e-6,
        0.12485718722177368,
        7.2944655708638995e-6,
        0.027573283146777115,
        0.2054892737206304,
        2.8348996694855076e-6,
        2.9105454818798966e-6,
        0.11302346880675787,
        0.00479890972492748,
        0.021828683750069338,
        0.04448619830695339,
        0.15165114456364492,
        0.005657552184573939,
        0.09393215180254051,
    ]

    w10t = [
        0.007911813464310113,
        0.03068510213747275,
        0.010505366137939913,
        0.02748375285330511,
        0.012276170276067139,
        0.03340727036207522,
        3.968191684113028e-7,
        0.1398469015680947,
        6.62690268489184e-7,
        1.412505225860106e-5,
        0.2878192785440307,
        4.2200065419448415e-7,
        3.296864762413375e-7,
        0.12527560333674628,
        1.836077875288932e-6,
        0.015083599354027831,
        2.2788913817547395e-5,
        0.19311714086150886,
        8.333796539106878e-7,
        0.11654660648424862,
    ]

    w11t = [
        0.00793903125320826,
        0.030636783107861876,
        0.01048110372824957,
        0.027466140624982673,
        0.012246365030402126,
        0.033346816558601215,
        3.321651005514294e-7,
        0.13984291378884364,
        8.614461008676049e-7,
        5.545992913276122e-5,
        0.28787319698366126,
        3.861704770491216e-7,
        2.640699241011262e-7,
        0.12526456222667107,
        4.294466642602268e-6,
        0.015064734243932945,
        9.125180756714214e-5,
        0.19312950512693652,
        1.4284870038683972e-6,
        0.11655456878469989,
    ]

    w12t = [
        0.03333132747369123,
        0.04377810669687917,
        0.023427973082167475,
        0.022909798021813328,
        0.018688369967461656,
        0.06451207225655833,
        7.844230625498396e-6,
        0.12486014474751483,
        2.4862736037898968e-5,
        0.027564656122779495,
        0.20549775936633694,
        9.756425508052093e-6,
        1.0147812841754239e-5,
        0.11302433562762651,
        0.00479652846069651,
        0.021822676636146853,
        0.044478776465909094,
        0.15165417399121,
        0.005671718381918033,
        0.09392897149627737,
    ]

    w13t = [
        0.007920657427616102,
        0.030668637277263787,
        0.010500432216142167,
        0.02747291052000619,
        0.012271335324959031,
        0.03339309453273026,
        1.7288807624662253e-6,
        0.1398419645980313,
        2.9026467834348955e-6,
        6.137370886041355e-5,
        0.2878082866151442,
        1.846323615352377e-6,
        1.4383344416742414e-6,
        0.12524860212395514,
        7.99751837573715e-6,
        0.015077475176263464,
        9.879305762316453e-5,
        0.19309419174111606,
        3.645964678029406e-6,
        0.11652268601163202,
    ]

    w14t = [
        0.007947663163244596,
        0.030625047296103682,
        0.01047862348378339,
        0.027460192068177368,
        0.012241160964199947,
        0.03333609346675206,
        4.1339265369820715e-7,
        0.1398416927949212,
        1.0653378509919095e-6,
        6.903552954991299e-5,
        0.2878794634408518,
        4.803921891880479e-7,
        3.298406858798465e-7,
        0.12525886974969547,
        5.34655825897842e-6,
        0.015061428646235895,
        0.00011364380960639928,
        0.1931280851296518,
        1.764561667630372e-6,
        0.11654960037392013,
    ]

    w15t = [
        0.03333068397098794,
        0.04377757634667947,
        0.023427280647738524,
        0.022909139061975062,
        0.018687717089428593,
        0.06451179945808709,
        7.872726015530742e-6,
        0.12486048096043566,
        2.491670016457108e-5,
        0.027564009124648573,
        0.20549903841837924,
        9.775748954866916e-6,
        1.0189359464332593e-5,
        0.11302512599651851,
        0.004796269727344396,
        0.021822090713067257,
        0.044478258799500084,
        0.15165528349872529,
        0.005673047159692591,
        0.0939294444921923,
    ]

    w16t = [
        0.007909532269239685,
        0.030689732371716544,
        0.010506794265829837,
        0.027486773064477565,
        0.01227752407536516,
        0.03341134826027093,
        2.5150449549825336e-8,
        0.13984830025446535,
        4.249827078239585e-8,
        9.042694634714465e-7,
        0.28782216287128803,
        2.7037444945085863e-8,
        2.0887494979613736e-8,
        0.12528315698780826,
        1.1728710494657163e-7,
        0.015085354653891736,
        1.4584393287540855e-6,
        0.1931234446153508,
        5.340947835156622e-8,
        0.11655322733126024,
    ]

    w17t = [
        0.007912474356664999,
        0.03068630180703677,
        0.010504007255190455,
        0.027486140178580355,
        0.012274222071611914,
        0.03340552553193652,
        5.597958383265661e-9,
        0.1398480754946482,
        1.4485214437168179e-8,
        9.281103731810237e-7,
        0.28782817177665754,
        6.510348807160632e-9,
        4.456059381695063e-9,
        0.12528445705952634,
        7.244863074537961e-8,
        0.015083725660309414,
        1.5154656076760134e-6,
        0.1931267231653743,
        2.405208972568205e-8,
        0.11655760451618083,
    ]

    w18t = [
        0.03333803093029847,
        0.04378509678513202,
        0.02343570240310936,
        0.022916678252223092,
        0.01869405873554269,
        0.06451728594605739,
        2.2538082662688216e-6,
        0.12485718722177368,
        7.2944655708638995e-6,
        0.027573283146777115,
        0.2054892737206304,
        2.8348996694855076e-6,
        2.9105454818798966e-6,
        0.11302346880675787,
        0.00479890972492748,
        0.021828683750069338,
        0.04448619830695339,
        0.15165114456364492,
        0.005657552184573939,
        0.09393215180254051,
    ]

    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t)
    @test isapprox(w3.weights, w3t)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t)
    @test isapprox(w6.weights, w6t)
    @test isapprox(w7.weights, w7t)
    @test isapprox(w8.weights, w8t)
    @test isapprox(w9.weights, w9t)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t)
    @test isapprox(w12.weights, w12t)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t)
    @test isapprox(w15.weights, w15t)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t)
    @test isapprox(w18.weights, w18t)
    @test isapprox(w0.weights, w1.weights)
    @test isapprox(w0.weights, w10.weights)
    @test isapprox(w1.weights, w10.weights)
    @test isapprox(w3.weights, w12.weights)
    @test isapprox(w7.weights, w16.weights)
    @test isapprox(w9.weights, w18.weights)
end

@testset "$(:Classic), $(:WC), $(:Utility)" begin
    portfolio = Portfolio(
        prices = prices,
        solvers = OrderedDict(
            :Clarabel => Dict(
                :solver => Clarabel.Optimizer,
                :params => Dict("verbose" => false, "max_step_fraction" => 0.75),
            ),
            :COSMO =>
                Dict(:solver => COSMO.Optimizer, :params => Dict("verbose" => false)),
        ),
    )
    asset_statistics!(portfolio)
    w0 = opt_port!(
        portfolio;
        class = :Classic,
        type = :Trad,
        obj = :Utility,
        l = l,
        rf = rf,
        rm = :SD,
    )

    wc_statistics!(portfolio, box = :Normal, ellipse = :Normal, seed = 123456789)
    w1 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :None,
    )
    w2 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :None,
    )
    w3 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :None,
    )
    w4 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :Box,
    )
    w5 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :Box,
    )
    w6 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :Box,
    )
    w7 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :Ellipse,
    )
    w8 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :Ellipse,
    )
    w9 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :Ellipse,
    )
    wc_statistics!(portfolio, box = :Delta, ellipse = :Normal, seed = 123456789)
    w10 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :None,
    )
    w11 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :None,
    )
    w12 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :None,
    )
    w13 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :Box,
    )
    w14 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :Box,
    )
    w15 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :Box,
    )
    w16 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :Ellipse,
    )
    w17 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :Ellipse,
    )
    w18 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Utility,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :Ellipse,
    )

    w1t = [
        1.8806825315287365e-9,
        3.862038288374664e-9,
        5.3002004387495145e-9,
        4.036002575991236e-9,
        0.7741908142503021,
        3.8445966380599916e-10,
        0.10998661007165159,
        1.852701338887806e-9,
        5.530542601292167e-9,
        1.7145172711134676e-9,
        1.5657439073700846e-9,
        4.404614975595981e-10,
        8.278998697027929e-10,
        3.393489762947003e-10,
        7.56536345977105e-10,
        0.11582251334241239,
        1.8378733654274228e-8,
        2.095243020357391e-9,
        1.0434852414339229e-8,
        2.9356695212202287e-9,
    ]

    w2t = [
        2.4597721939829205e-8,
        5.3334723693256023e-8,
        9.161262815212586e-8,
        5.6227980295204534e-8,
        0.7852300405962237,
        7.906993703138196e-9,
        0.09257262492157539,
        2.302247703910284e-8,
        8.464294228048582e-8,
        2.190799241592125e-8,
        2.0579644988992078e-8,
        7.462346827405608e-9,
        5.6796215789863885e-9,
        1.1777227790690165e-8,
        5.635749774970178e-9,
        0.12219481393664303,
        1.7175634087256247e-6,
        2.5513588920123325e-8,
        3.2626857470542925e-7,
        3.6811934903731855e-8,
    ]

    w3t = [
        4.1804289279986413e-7,
        1.2887935975813407e-6,
        0.04358625607086607,
        3.5221900054311783e-6,
        0.4326296929598245,
        6.700501954953114e-8,
        0.08625292850424326,
        2.6789790304929126e-7,
        1.371698959388878e-6,
        2.4667660040098866e-7,
        2.3390696903864516e-7,
        6.32920925553779e-8,
        4.233791947470049e-8,
        1.132979274024383e-7,
        4.277804015680886e-8,
        0.1381274652638734,
        0.23000775828640155,
        2.9529288417622025e-7,
        0.06938729109478944,
        6.346091908870953e-7,
    ]

    w4t = [
        5.252194395056978e-9,
        1.0315354940168556e-8,
        9.455445139288418e-9,
        4.013209229711783e-9,
        0.5819241901849773,
        6.270890448664268e-10,
        2.0561433724117197e-9,
        6.707564335612324e-9,
        7.865563734245912e-9,
        4.17450063970948e-9,
        1.0991695351988044e-8,
        2.190782811533936e-10,
        1.1231785837732019e-10,
        2.540524563038986e-9,
        1.8113974061846706e-10,
        1.0750087695591245e-8,
        0.4180755819596067,
        1.2097725746430656e-8,
        1.273857143447765e-7,
        1.3110067658773902e-8,
    ]

    w5t = [
        7.108551708760028e-8,
        1.616997699105016e-7,
        1.4828641813784753e-7,
        5.160644783663039e-8,
        0.5510594362462894,
        1.8028152466558224e-8,
        2.8394812208650447e-8,
        8.863260381877312e-8,
        9.994858223690542e-8,
        5.2029409659132555e-8,
        1.8101852236621843e-7,
        1.176585660077965e-8,
        6.983703599892964e-9,
        3.541043036388848e-8,
        8.347087135733956e-9,
        1.4188952288643594e-7,
        0.44893412806984556,
        2.0484826330201755e-7,
        4.882924426641968e-6,
        2.427843387846295e-7,
    ]

    w6t = [
        8.509487027227752e-7,
        7.952778134265089e-6,
        0.0034957807160297797,
        4.4520416950522696e-7,
        0.3540750348973147,
        1.0282921222001677e-7,
        1.7949548722046367e-7,
        8.546696814369276e-7,
        7.27173703906594e-7,
        3.760847873561267e-7,
        3.984472765323392e-6,
        6.166729011969016e-8,
        3.323166058835131e-8,
        2.356794883894483e-7,
        4.093606256545967e-8,
        2.196158136221485e-6,
        0.40713410101212,
        5.418071415330693e-6,
        0.19143418380129953,
        0.04383744017253891,
    ]

    w7t = [
        0.06154148810193682,
        0.07055303049160111,
        0.07094003465884087,
        0.04171713541861104,
        0.106524690006666,
        3.473398251311163e-8,
        0.020758448751352517,
        0.05117081953119774,
        0.05272467836890281,
        0.03425069187399879,
        0.07283158866452577,
        3.47029421652274e-8,
        1.4611604084024919e-8,
        2.969841230044783e-6,
        1.6275824321409947e-8,
        0.04635834382067999,
        0.1219952421974018,
        0.074795262801851,
        0.08947880598030208,
        0.08435666916654858,
    ]

    w8t = [
        0.06128078985117875,
        0.07023530946235386,
        0.0700617975082126,
        0.040472109399727,
        0.104841645792296,
        7.342022841131779e-10,
        0.01936278240249619,
        0.05213011960993491,
        0.05172736355424607,
        0.03388849475985304,
        0.07645537726746798,
        7.199175510075686e-10,
        2.651021934697033e-10,
        0.000851390355528379,
        2.9630503492433385e-10,
        0.044875155498863645,
        0.12214348171465972,
        0.07722340264156942,
        0.08937149724916715,
        0.08507928091691817,
    ]

    w9t = [
        0.061891199296567154,
        0.07006875320734889,
        0.06965994090299954,
        0.0412560253083881,
        0.10114640335969857,
        3.7756830161449545e-7,
        0.019909531925689908,
        0.05317764189861447,
        0.052464585422301854,
        0.03573165618456555,
        0.07635397066875593,
        3.6670594647331925e-7,
        1.4392705235938842e-7,
        0.005290249899321128,
        1.6085209603720218e-7,
        0.04492861578060417,
        0.11867605766114496,
        0.07707218496378836,
        0.08800335879679347,
        0.08436877567002157,
    ]

    w10t = [
        1.8806825315287365e-9,
        3.862038288374664e-9,
        5.3002004387495145e-9,
        4.036002575991236e-9,
        0.7741908142503021,
        3.8445966380599916e-10,
        0.10998661007165159,
        1.852701338887806e-9,
        5.530542601292167e-9,
        1.7145172711134676e-9,
        1.5657439073700846e-9,
        4.404614975595981e-10,
        8.278998697027929e-10,
        3.393489762947003e-10,
        7.56536345977105e-10,
        0.11582251334241239,
        1.8378733654274228e-8,
        2.095243020357391e-9,
        1.0434852414339229e-8,
        2.9356695212202287e-9,
    ]

    w11t = [
        9.178261490669616e-9,
        1.6315087114096756e-8,
        2.6501024358585536e-8,
        1.7533628352492652e-8,
        0.7565378148197015,
        4.0440465321891905e-9,
        0.10592891461003602,
        8.786631643500756e-9,
        2.4559046270560293e-8,
        8.475842316045524e-9,
        8.090149174480523e-9,
        3.893899204647758e-9,
        3.063565399597353e-9,
        5.4676590151644815e-9,
        3.0698988976522083e-9,
        0.13753263418510286,
        3.891300393550763e-7,
        9.416452560962829e-9,
        8.66061540006895e-8,
        1.2253773881356594e-8,
    ]

    w12t = [
        4.1804289279986413e-7,
        1.2887935975813407e-6,
        0.04358625607086607,
        3.5221900054311783e-6,
        0.4326296929598245,
        6.700501954953114e-8,
        0.08625292850424326,
        2.6789790304929126e-7,
        1.371698959388878e-6,
        2.4667660040098866e-7,
        2.3390696903864516e-7,
        6.32920925553779e-8,
        4.233791947470049e-8,
        1.132979274024383e-7,
        4.277804015680886e-8,
        0.1381274652638734,
        0.23000775828640155,
        2.9529288417622025e-7,
        0.06938729109478944,
        6.346091908870953e-7,
    ]

    w13t = [
        3.647902119428961e-10,
        2.1977715335790454e-9,
        4.064170032796999e-9,
        2.3972232748394194e-9,
        0.75478163814755,
        1.0679235246725186e-9,
        0.10551594374842024,
        3.776810262001307e-10,
        4.357820292261647e-9,
        2.573044832077191e-10,
        2.0018803785122081e-10,
        1.0995315175089325e-9,
        1.220582723514187e-9,
        6.127953723783301e-10,
        1.2973729020478185e-9,
        0.13970233618556752,
        4.547259952804259e-8,
        5.552311979866896e-10,
        1.5145933671581878e-8,
        1.229542917036613e-9,
    ]

    w14t = [
        2.264488046167412e-8,
        5.792490303780861e-8,
        1.0506524528865325e-7,
        6.13471003928948e-8,
        0.7308731581676463,
        6.76697397026859e-9,
        0.10068852325299898,
        2.0494769201371338e-8,
        1.0094986749363388e-7,
        1.9158661576175614e-8,
        1.801260848924599e-8,
        6.422897690533176e-9,
        4.795547873764284e-9,
        1.0070738198208984e-8,
        4.8240087406826055e-9,
        0.15517833787814167,
        0.013258759206781311,
        2.3130376714013543e-8,
        7.232300780737276e-7,
        3.665577474260631e-8,
    ]

    w15t = [
        1.0962941226797925e-6,
        5.8707992543105085e-6,
        0.057369898600559,
        4.041369529424159e-5,
        0.4004756112921992,
        1.0286573250518107e-7,
        0.078650355915255,
        5.760138360511287e-7,
        4.440726009983371e-6,
        5.01596042457426e-7,
        4.728110411738684e-7,
        9.690523547439525e-8,
        6.353231521803735e-8,
        1.8535625724009037e-7,
        6.452045439802777e-8,
        0.13380556550126554,
        0.23672811438013638,
        6.593621825664399e-7,
        0.09291374124542368,
        2.1685873828103747e-6,
    ]

    w16t = [
        0.06154148810193682,
        0.07055303049160111,
        0.07094003465884087,
        0.04171713541861104,
        0.106524690006666,
        3.473398251311163e-8,
        0.020758448751352517,
        0.05117081953119774,
        0.05272467836890281,
        0.03425069187399879,
        0.07283158866452577,
        3.47029421652274e-8,
        1.4611604084024919e-8,
        2.969841230044783e-6,
        1.6275824321409947e-8,
        0.04635834382067999,
        0.1219952421974018,
        0.074795262801851,
        0.08947880598030208,
        0.08435666916654858,
    ]

    w17t = [
        0.06092544992127543,
        0.0701244542181588,
        0.07015927501069102,
        0.04129150199774511,
        0.10537819722279247,
        5.783655977474454e-10,
        0.02041542996852254,
        0.05272428436758032,
        0.05188725353424002,
        0.034253714625499886,
        0.07562782136169188,
        5.860621570953921e-10,
        2.400019278474348e-10,
        0.0004508841309540613,
        2.667036198515615e-10,
        0.04610248358083304,
        0.12113152425735114,
        0.07628555484800673,
        0.08875897624803987,
        0.08448319303548439,
    ]

    w18t = [
        0.061891199296567154,
        0.07006875320734889,
        0.06965994090299954,
        0.0412560253083881,
        0.10114640335969857,
        3.7756830161449545e-7,
        0.019909531925689908,
        0.05317764189861447,
        0.052464585422301854,
        0.03573165618456555,
        0.07635397066875593,
        3.6670594647331925e-7,
        1.4392705235938842e-7,
        0.005290249899321128,
        1.6085209603720218e-7,
        0.04492861578060417,
        0.11867605766114496,
        0.07707218496378836,
        0.08800335879679347,
        0.08436877567002157,
    ]

    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t)
    @test isapprox(w3.weights, w3t)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t)
    @test isapprox(w6.weights, w6t)
    @test isapprox(w7.weights, w7t)
    @test isapprox(w8.weights, w8t)
    @test isapprox(w9.weights, w9t, rtol = 1.0e-6)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t)
    @test isapprox(w12.weights, w12t)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t)
    @test isapprox(w15.weights, w15t)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t)
    @test isapprox(w18.weights, w18t, rtol = 1.0e-6)
    @test isapprox(w0.weights, w1.weights)
    @test isapprox(w0.weights, w10.weights)
    @test isapprox(w1.weights, w10.weights)
    @test isapprox(w3.weights, w12.weights)
    @test isapprox(w7.weights, w16.weights)
    @test isapprox(w9.weights, w18.weights)
end

@testset "$(:Classic), $(:WC), $(:Sharpe)" begin
    portfolio = Portfolio(
        prices = prices,
        solvers = OrderedDict(
            :Clarabel => Dict(
                :solver => Clarabel.Optimizer,
                :params => Dict("verbose" => false, "max_step_fraction" => 0.75),
            ),
            :COSMO =>
                Dict(:solver => COSMO.Optimizer, :params => Dict("verbose" => false)),
        ),
    )
    asset_statistics!(portfolio)
    w0 = opt_port!(
        portfolio;
        class = :Classic,
        type = :Trad,
        obj = :Sharpe,
        l = l,
        rf = rf,
        rm = :SD,
    )

    wc_statistics!(portfolio, box = :Normal, ellipse = :Normal, seed = 123456789)
    w1 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Sharpe,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :None,
    )
    w2 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Sharpe,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :None,
    )
    w3 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Sharpe,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :None,
    )
    w4 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Sharpe,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :Box,
    )
    w5 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Sharpe,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :Box,
    )
    w6 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Sharpe,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :Box,
    )
    wc_statistics!(portfolio, box = :Delta, ellipse = :Normal, seed = 123456789)
    w10 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Sharpe,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :None,
    )
    w11 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Sharpe,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :None,
    )
    w12 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Sharpe,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :None,
    )
    w13 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Sharpe,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :Box,
    )
    w14 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Sharpe,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :Box,
    )
    w15 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Sharpe,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :Box,
    )

    w1t = [
        1.0582219191763675e-9,
        3.033341281368263e-9,
        4.093973467616387e-9,
        2.4302432491378547e-9,
        0.518058049464457,
        3.284428917099043e-10,
        0.06365095369119145,
        2.483269319093602e-9,
        2.345993206888518e-9,
        1.1710759933582023e-9,
        1.9667796025518083e-9,
        2.6638354190663204e-10,
        1.933888387868567e-10,
        5.926494610003628e-10,
        1.8755971351419546e-10,
        0.143267787756283,
        0.19649630246514146,
        2.335142195851285e-9,
        0.07852688169059606,
        2.4458664972621787e-9,
    ]

    w2t = [
        1.6023095838424963e-8,
        0.0018773255976685613,
        7.208895230858323e-7,
        1.6896272269652147e-7,
        0.26579632519442953,
        1.6796073680741161e-9,
        0.012126419527774582,
        0.06811732441561323,
        2.799037071374007e-8,
        2.635243278315092e-8,
        0.1600502518244709,
        1.067980284957116e-9,
        7.465244040135797e-10,
        6.17684123796929e-9,
        7.862050720289891e-10,
        0.07364060572653174,
        0.2011382777713979,
        0.10060850607071083,
        0.08612710538016058,
        0.030516887815938736,
    ]

    w3t = [
        0.0013787087224829111,
        0.05289553878281216,
        0.056810880897601196,
        0.02988552498572654,
        0.14968593709172215,
        1.5844977623097642e-8,
        0.023170653967966925,
        0.07708660077578645,
        0.0015879143029418274,
        4.649801272252376e-7,
        0.12834995880314407,
        1.0649331770080986e-8,
        6.875220057310812e-9,
        5.589018985730717e-8,
        7.89479791664368e-9,
        0.06552611378458557,
        0.14094703247713888,
        0.09810216681813286,
        0.09252508716291984,
        0.08204731929239428,
    ]

    w4t = [
        6.466684324776656e-11,
        8.516807283687845e-11,
        9.472315022300327e-11,
        5.1957167657756756e-11,
        0.9999999985074259,
        2.0192854664051626e-11,
        3.436252425053897e-11,
        5.149260592067322e-11,
        7.462642590762538e-11,
        4.561655322527492e-11,
        6.186767722266438e-11,
        1.3899284282467578e-11,
        7.750637790067232e-12,
        3.337064177968372e-11,
        9.659444439315246e-12,
        7.302466718285475e-11,
        4.5866872942896926e-10,
        7.012474376020365e-11,
        1.5414496160965011e-10,
        8.72570588192862e-11,
    ]

    w5t = [
        1.9270878658506116e-10,
        3.137216142815297e-10,
        3.22478003768024e-10,
        1.4903535779915166e-10,
        0.7010284428697937,
        5.017984087342434e-11,
        8.771879737391066e-11,
        1.826273745564694e-10,
        2.5568500045549557e-10,
        1.403283806606418e-10,
        2.548148826267939e-10,
        3.263978848475229e-11,
        1.7876358571386225e-11,
        9.668786005750116e-11,
        2.172978679053518e-11,
        2.800239391685582e-10,
        0.2989715525789651,
        2.92297326137468e-10,
        1.5049465921925983e-9,
        3.5574147449785123e-10,
    ]

    w6t = [
        2.506095649549513e-9,
        4.073932462549125e-9,
        5.398203824382228e-9,
        1.7124152016083e-9,
        0.5595813927700654,
        5.041149809015869e-10,
        9.301581926261557e-10,
        1.7772324676327418e-9,
        2.925154318124677e-9,
        1.4345380281140104e-9,
        2.4613263738856962e-9,
        3.356445049268043e-10,
        1.8302054465026085e-10,
        9.607030827561177e-10,
        2.2269986409270587e-10,
        2.973016099880799e-9,
        0.440418533386535,
        2.9159143281310575e-9,
        3.789912264383553e-8,
        4.630106930193754e-9,
    ]

    w10t = [
        1.0582219191763675e-9,
        3.033341281368263e-9,
        4.093973467616387e-9,
        2.4302432491378547e-9,
        0.518058049464457,
        3.284428917099043e-10,
        0.06365095369119145,
        2.483269319093602e-9,
        2.345993206888518e-9,
        1.1710759933582023e-9,
        1.9667796025518083e-9,
        2.6638354190663204e-10,
        1.933888387868567e-10,
        5.926494610003628e-10,
        1.8755971351419546e-10,
        0.143267787756283,
        0.19649630246514146,
        2.335142195851285e-9,
        0.07852688169059606,
        2.4458664972621787e-9,
    ]

    w11t = [
        1.137500948120189e-8,
        0.007767216363858669,
        0.0038692087591282727,
        0.0027570024194872094,
        0.2509960261074485,
        1.6381042501880397e-9,
        0.023158950665596006,
        0.08562307129943122,
        2.2050421353344477e-8,
        1.9571823238068067e-8,
        0.16236840669650152,
        1.0628780010429409e-9,
        7.445403035218761e-10,
        5.110020528237411e-9,
        7.964988071092071e-10,
        0.08334311485267705,
        0.16535048116340906,
        0.10483321786906197,
        0.07552258565099003,
        0.034410655803114684,
    ]

    w12t = [
        0.0013787087224829111,
        0.05289553878281216,
        0.056810880897601196,
        0.02988552498572654,
        0.14968593709172215,
        1.5844977623097642e-8,
        0.023170653967966925,
        0.07708660077578645,
        0.0015879143029418274,
        4.649801272252376e-7,
        0.12834995880314407,
        1.0649331770080986e-8,
        6.875220057310812e-9,
        5.589018985730717e-8,
        7.89479791664368e-9,
        0.06552611378458557,
        0.14094703247713888,
        0.09810216681813286,
        0.09252508716291984,
        0.08204731929239428,
    ]

    w13t = [
        7.86104680168596e-11,
        2.581689370363608e-10,
        3.751927152447362e-10,
        2.1247028587508447e-10,
        0.523634883488626,
        1.9486433116903062e-11,
        0.06464274713780861,
        1.549689208956321e-10,
        2.0554803821712053e-10,
        7.975947674723269e-11,
        1.2077742964126379e-10,
        1.6434493809377638e-11,
        1.1964486515368817e-11,
        3.6573008241479916e-11,
        1.0468424536562565e-11,
        0.14384439793458836,
        0.19321690478313466,
        1.5557988191105592e-10,
        0.07466106472997303,
        1.898664279910272e-10,
    ]

    w14t = [
        1.2263904439118016e-8,
        0.007060252113352363,
        0.0036540730976423025,
        0.0021522184115763767,
        0.2551009198991718,
        1.1756276183234802e-9,
        0.023705335955290292,
        0.08460251834282648,
        2.3885920274456877e-8,
        2.0788888043866e-8,
        0.15915641603733602,
        7.943942762030404e-10,
        5.310613607982868e-10,
        3.797525765151979e-9,
        5.674070944570201e-10,
        0.08446004253353889,
        0.16761618932791755,
        0.10250681464525724,
        0.07714491088562073,
        0.03284024494574102,
    ]

    w15t = [
        0.0006282233178678226,
        0.05287549789848403,
        0.05737887196391587,
        0.029901307165251002,
        0.1519608083040642,
        4.048275468493054e-9,
        0.02364942049128517,
        0.07586171942896551,
        0.0014576118756893458,
        1.626460386860333e-7,
        0.1258785528561344,
        2.810262250179148e-9,
        1.879765140683403e-9,
        1.377120981300937e-8,
        2.1342842672227618e-9,
        0.06631322271275503,
        0.1425384527969583,
        0.09642365480622034,
        0.09353407631628467,
        0.08159839277628878,
    ]

    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t, rtol = 1.0e-6)
    @test isapprox(w3.weights, w3t, rtol = 1e-7)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t, rtol = 1.0e-6)
    @test isapprox(w6.weights, w6t, rtol = 1.0e-6)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t, rtol = 1.0e-6)
    @test isapprox(w12.weights, w12t, rtol = 1e-7)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t, rtol = 1.0e-5)
    @test isapprox(w15.weights, w15t, rtol = 1.0e-6)
    @test isapprox(w0.weights, w1.weights, rtol = 1.0e-7)
    @test isapprox(w0.weights, w10.weights, rtol = 1.0e-7)
    @test isapprox(w1.weights, w10.weights)
    @test isapprox(w3.weights, w12.weights)
end

@testset "$(:Classic), $(:WC), $(:Max_Ret)" begin
    portfolio = Portfolio(
        prices = prices,
        solvers = OrderedDict(
            :Clarabel => Dict(
                :solver => Clarabel.Optimizer,
                :params => Dict("verbose" => false, "max_step_fraction" => 0.75),
            ),
            :COSMO =>
                Dict(:solver => COSMO.Optimizer, :params => Dict("verbose" => false)),
        ),
    )
    asset_statistics!(portfolio)
    w0 = opt_port!(
        portfolio;
        class = :Classic,
        type = :Trad,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        rm = :SD,
    )

    wc_statistics!(portfolio, box = :Normal, ellipse = :Normal, seed = 123456789)
    w1 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :None,
    )
    w2 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :None,
    )
    w3 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :None,
    )
    w4 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :Box,
    )
    w5 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :Box,
    )
    w6 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :Box,
    )
    w7 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :Ellipse,
    )
    w8 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :Ellipse,
    )
    w9 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :Ellipse,
    )
    wc_statistics!(portfolio, box = :Delta, ellipse = :Normal, seed = 123456789)
    w10 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :None,
    )
    w11 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :None,
    )
    w12 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :None,
    )
    w13 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :Box,
    )
    w14 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :Box,
    )
    w15 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :Box,
    )
    w16 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :None,
        u_mu = :Ellipse,
    )
    w17 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :Box,
        u_mu = :Ellipse,
    )
    w18 = opt_port!(
        portfolio;
        class = :Classic,
        type = :WC,
        obj = :Max_Ret,
        l = l,
        rf = rf,
        u_cov = :Ellipse,
        u_mu = :Ellipse,
    )

    w1t = [
        2.242587206880573e-8,
        2.3869345719665024e-8,
        3.0249972077364615e-8,
        2.7441036414624337e-8,
        2.674016473443787e-6,
        1.111794542964317e-8,
        0.999996954927899,
        1.6603745204232977e-8,
        2.5223224543701134e-8,
        1.8088400369515617e-8,
        1.6172380723211374e-8,
        1.16166386268502e-8,
        8.681387038232673e-9,
        1.3771962838160079e-8,
        8.992921449936008e-9,
        4.039243448317557e-8,
        3.1600448893350835e-8,
        1.7426103715815354e-8,
        2.6166436902355393e-8,
        2.121537093958793e-8,
    ]

    w2t = [
        6.812069679415873e-8,
        7.292335672662803e-8,
        9.453887392298778e-8,
        8.462965495479703e-8,
        8.705867339240855e-6,
        3.3173862339437415e-8,
        0.9999901545796747,
        4.9591829664822806e-8,
        7.757928492674582e-8,
        5.423562617200086e-8,
        4.81572504886394e-8,
        3.4795624717506246e-8,
        2.653065141059767e-8,
        4.0909401719147554e-8,
        2.7261285736079847e-8,
        1.305248146310728e-7,
        9.947324862672363e-8,
        5.205573007639602e-8,
        8.084788246390215e-8,
        6.420391053328686e-8,
    ]

    w3t = [
        4.95030988191767e-8,
        5.2927808063790595e-8,
        6.839833890549716e-8,
        6.129456705156604e-8,
        6.820408470794322e-6,
        2.4510331018201016e-8,
        0.9999923502409352,
        3.630840160070793e-8,
        5.6252136034810497e-8,
        3.96169826964757e-8,
        3.528502630390782e-8,
        2.5687432032914555e-8,
        1.9653077072354532e-8,
        3.009776258323475e-8,
        2.0190066621865724e-8,
        9.431730939675246e-8,
        7.194230483020115e-8,
        3.806448520149792e-8,
        5.8588565796257147e-8,
        4.671289985471904e-8,
    ]

    w4t = [
        4.2042049734727806e-8,
        4.521518897189257e-8,
        5.659006070667893e-8,
        3.514877814292186e-8,
        0.9999993010578468,
        1.5765085402586468e-8,
        2.7221728971256205e-8,
        2.833331125793981e-8,
        4.0442398566396016e-8,
        2.820564078004165e-8,
        3.015401882144552e-8,
        1.3622176589629896e-8,
        8.610124539098548e-9,
        2.1881580106619616e-8,
        1.0054344351204034e-8,
        3.857715060414015e-8,
        1.2018663273637416e-7,
        3.337382833665426e-8,
        5.928283670571385e-8,
        4.42352177893344e-8,
    ]

    w5t = [
        9.377415466609279e-8,
        1.0272420517112992e-7,
        1.2379069963449228e-7,
        7.88908877064689e-8,
        0.9999984542188851,
        3.381052043433265e-8,
        6.063461327909876e-8,
        6.528284321580322e-8,
        9.272801754761999e-8,
        6.438645876637771e-8,
        7.101071935434272e-8,
        2.8462432632992756e-8,
        1.7554303492159786e-8,
        4.916101198170805e-8,
        2.050205062361616e-8,
        8.907634792253174e-8,
        2.403215484938327e-7,
        7.852171953659121e-8,
        1.338002068689107e-7,
        1.0134837351440007e-7,
    ]

    w6t = [
        5.076068455001598e-8,
        5.569873138170204e-8,
        6.757152221686033e-8,
        4.279059232815473e-8,
        0.9999991513908487,
        1.86769755302069e-8,
        3.327739895308364e-8,
        3.5346759632585386e-8,
        5.022077189935659e-8,
        3.494940026853752e-8,
        3.8306821257477045e-8,
        1.5923444281812635e-8,
        9.96998003627379e-9,
        2.6770159069168894e-8,
        1.1587295704269592e-8,
        4.832663518553815e-8,
        1.377775184707589e-7,
        4.237993795727775e-8,
        7.335955284908911e-8,
        5.491496952075916e-8,
    ]

    w7t = [
        0.06890844046144488,
        0.07563301277540496,
        0.08064180211050946,
        0.04718407812860236,
        0.12123502290772788,
        7.0313224803652085e-9,
        0.02506892317635273,
        0.03072415112000338,
        0.06253783187722084,
        0.03349353671003257,
        0.03704527471874409,
        9.024440907298205e-9,
        3.392187193830196e-9,
        3.5586483043216114e-8,
        3.6559770971977593e-9,
        0.04942196685863766,
        0.13244524162705806,
        0.05548138936532516,
        0.0977197318858018,
        0.08245953758672354,
    ]

    w8t = [
        0.06890840444100681,
        0.07563296700087997,
        0.08064175237302901,
        0.047184070427970175,
        0.1212349374788409,
        2.8975417463047654e-8,
        0.025068926687489616,
        0.03072427574438468,
        0.06253780533916545,
        0.033493594503237245,
        0.037045411879595536,
        3.7126647764728154e-8,
        1.4048418138863368e-8,
        1.473585842432503e-7,
        1.503771375237347e-8,
        0.04942195193001917,
        0.1324451313110057,
        0.05548139045484467,
        0.09771965938255386,
        0.08245947849919592,
    ]

    w9t = [
        0.06890843956800953,
        0.07563301119464684,
        0.0806418012064073,
        0.047184078317537896,
        0.12123502115366945,
        6.978991582810316e-9,
        0.025068924245034763,
        0.030724156275500174,
        0.06253783219081958,
        0.033493540456902574,
        0.037045279933037654,
        8.912269807691023e-9,
        3.3710329827405475e-9,
        3.541042259960182e-8,
        3.6111168587983484e-9,
        0.04942196625795658,
        0.1324452391783881,
        0.055481386945173336,
        0.09771973031135159,
        0.08245953448173084,
    ]

    w10t = [
        2.242587206880573e-8,
        2.3869345719665024e-8,
        3.0249972077364615e-8,
        2.7441036414624337e-8,
        2.674016473443787e-6,
        1.111794542964317e-8,
        0.999996954927899,
        1.6603745204232977e-8,
        2.5223224543701134e-8,
        1.8088400369515617e-8,
        1.6172380723211374e-8,
        1.16166386268502e-8,
        8.681387038232673e-9,
        1.3771962838160079e-8,
        8.992921449936008e-9,
        4.039243448317557e-8,
        3.1600448893350835e-8,
        1.7426103715815354e-8,
        2.6166436902355393e-8,
        2.121537093958793e-8,
    ]

    w11t = [
        6.812069679415873e-8,
        7.292335672662803e-8,
        9.453887392298778e-8,
        8.462965495479703e-8,
        8.705867339240855e-6,
        3.3173862339437415e-8,
        0.9999901545796747,
        4.9591829664822806e-8,
        7.757928492674582e-8,
        5.423562617200086e-8,
        4.81572504886394e-8,
        3.4795624717506246e-8,
        2.653065141059767e-8,
        4.0909401719147554e-8,
        2.7261285736079847e-8,
        1.305248146310728e-7,
        9.947324862672363e-8,
        5.205573007639602e-8,
        8.084788246390215e-8,
        6.420391053328686e-8,
    ]

    w12t = [
        4.95030988191767e-8,
        5.2927808063790595e-8,
        6.839833890549716e-8,
        6.129456705156604e-8,
        6.820408470794322e-6,
        2.4510331018201016e-8,
        0.9999923502409352,
        3.630840160070793e-8,
        5.6252136034810497e-8,
        3.96169826964757e-8,
        3.528502630390782e-8,
        2.5687432032914555e-8,
        1.9653077072354532e-8,
        3.009776258323475e-8,
        2.0190066621865724e-8,
        9.431730939675246e-8,
        7.194230483020115e-8,
        3.806448520149792e-8,
        5.8588565796257147e-8,
        4.671289985471904e-8,
    ]

    w13t = [
        2.2157629001814043e-8,
        2.3705206178889556e-8,
        3.1337524512027466e-8,
        2.7822239462468775e-8,
        3.817602380688397e-6,
        1.0845455226582203e-8,
        0.9999958072350622,
        1.6162961145208927e-8,
        2.5262648251923497e-8,
        1.7620900422092873e-8,
        1.572567737326121e-8,
        1.129544407446688e-8,
        8.418152681037229e-9,
        1.3392424290139792e-8,
        8.742579157457356e-9,
        4.5537115159563596e-8,
        3.30644482886816e-8,
        1.6950167741040277e-8,
        2.6312815513451374e-8,
        2.0809168671644914e-8,
    ]

    w14t = [
        5.899176155977146e-8,
        6.352041161149178e-8,
        8.600029605808529e-8,
        7.526478149335896e-8,
        1.0659087339205188e-5,
        2.905775505425437e-8,
        0.9999883227605479,
        4.2748755292844277e-8,
        6.806868346707394e-8,
        4.668110537995891e-8,
        4.154475065075079e-8,
        3.043151009488251e-8,
        2.3305213432859126e-8,
        3.550882660275843e-8,
        2.394697512652423e-8,
        1.2988293657634838e-7,
        9.160058718243988e-8,
        4.482747997689188e-8,
        7.135827897588707e-8,
        5.541200429693855e-8,
    ]

    w15t = [
        4.089151268042951e-8,
        4.390405865440736e-8,
        5.854738755161775e-8,
        5.1601573142166196e-8,
        8.055417042127276e-6,
        2.0423709660326297e-8,
        0.9999912434235497,
        2.98629667666177e-8,
        4.690244246182486e-8,
        3.255849005111389e-8,
        2.9035943166346777e-8,
        2.137640970761567e-8,
        1.641382013966909e-8,
        2.4882668215035932e-8,
        1.6862681277191053e-8,
        8.690479060469868e-8,
        6.215596877590331e-8,
        3.128913162314984e-8,
        4.905650184614425e-8,
        3.8489351906123836e-8,
    ]

    w16t = [
        0.06890844046144488,
        0.07563301277540496,
        0.08064180211050946,
        0.04718407812860236,
        0.12123502290772788,
        7.0313224803652085e-9,
        0.02506892317635273,
        0.03072415112000338,
        0.06253783187722084,
        0.03349353671003257,
        0.03704527471874409,
        9.024440907298205e-9,
        3.392187193830196e-9,
        3.5586483043216114e-8,
        3.6559770971977593e-9,
        0.04942196685863766,
        0.13244524162705806,
        0.05548138936532516,
        0.0977197318858018,
        0.08245953758672354,
    ]

    w17t = [
        0.06890840444100681,
        0.07563296700087997,
        0.08064175237302901,
        0.047184070427970175,
        0.1212349374788409,
        2.8975417463047654e-8,
        0.025068926687489616,
        0.03072427574438468,
        0.06253780533916545,
        0.033493594503237245,
        0.037045411879595536,
        3.7126647764728154e-8,
        1.4048418138863368e-8,
        1.473585842432503e-7,
        1.503771375237347e-8,
        0.04942195193001917,
        0.1324451313110057,
        0.05548139045484467,
        0.09771965938255386,
        0.08245947849919592,
    ]

    w18t = [
        0.06890843956800953,
        0.07563301119464684,
        0.0806418012064073,
        0.047184078317537896,
        0.12123502115366945,
        6.978991582810316e-9,
        0.025068924245034763,
        0.030724156275500174,
        0.06253783219081958,
        0.033493540456902574,
        0.037045279933037654,
        8.912269807691023e-9,
        3.3710329827405475e-9,
        3.541042259960182e-8,
        3.6111168587983484e-9,
        0.04942196625795658,
        0.1324452391783881,
        0.055481386945173336,
        0.09771973031135159,
        0.08245953448173084,
    ]

    @test isapprox(w1.weights, w1t)
    @test isapprox(w2.weights, w2t)
    @test isapprox(w3.weights, w3t)
    @test isapprox(w4.weights, w4t)
    @test isapprox(w5.weights, w5t)
    @test isapprox(w6.weights, w6t)
    @test isapprox(w7.weights, w7t)
    @test isapprox(w8.weights, w8t)
    @test isapprox(w9.weights, w9t)
    @test isapprox(w10.weights, w10t)
    @test isapprox(w11.weights, w11t)
    @test isapprox(w12.weights, w12t)
    @test isapprox(w13.weights, w13t)
    @test isapprox(w14.weights, w14t)
    @test isapprox(w15.weights, w15t)
    @test isapprox(w16.weights, w16t)
    @test isapprox(w17.weights, w17t)
    @test isapprox(w18.weights, w18t)
    @test isapprox(w0.weights, w1.weights)
    @test isapprox(w0.weights, w10.weights)
    @test isapprox(w1.weights, w10.weights)
    @test isapprox(w3.weights, w12.weights)
    @test isapprox(w7.weights, w16.weights)
    @test isapprox(w9.weights, w18.weights)
end
